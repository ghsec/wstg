# Просмотр старых резервных копий и неотреференных файлов для конфиденциальной информации

|ID          |
|------------|
|WSTG-CONF-04|

## Резюме

Хотя большинство файлов на веб-сервере напрямую обрабатываются самим сервером, нередко можно найти файлы без ссылок или забытых, которые можно использовать для получения важной информации об инфраструктуре или учетных данных.

Наиболее распространенные сценарии включают наличие переименованных старых версий измененных файлов, файлов включения, которые загружаются на выбранный язык и могут быть загружены в качестве исходного, или даже автоматическое или ручное резервное копирование в виде сжатых архивов. Резервные файлы также могут автоматически генерироваться базовой файловой системой, в которой размещено приложение, - функцией, обычно называемой «снимками».

Все эти файлы могут предоставлять тестеру доступ к внутренней работе, задним дверям, административным интерфейсам или даже учетным данным для подключения к административному интерфейсу или серверу базы данных.

Важный источник уязвимости лежит в файлах, которые не имеют ничего общего с приложением, но создаются как следствие редактирования файлов приложения, или после создания резервных копий на лету, или оставляя в веб-дереве старые файлы или файлы без ссылок. Выполнение редактирования на месте или другие административные действия на производственных веб-серверах может непреднамеренно оставить резервные копии, либо автоматически генерируется редактором при редактировании файлов, или администратором, который запускает набор файлов для создания резервной копии.

Такие файлы легко забыть, и это может представлять серьезную угрозу безопасности приложения. Это происходит потому, что резервные копии могут быть созданы с расширениями файлов, отличными от расширений оригинальных файлов. Архив `.tar`, `.zip` или `.gz`, который мы генерируем (и забудьте...) имеет, очевидно, другое расширение, и то же самое происходит с автоматическими копиями, созданными многими редакторами (например, emacs генерирует резервную копию с именем `file ~ `при редактировании `file`). Создание копии вручную может привести к тому же эффекту (подумайте о копировании `file` в `file.old`). Базовая файловая система, в которой находится приложение, может делать «снимки» вашего приложения в разные моменты времени без вашего ведома, который также может быть доступен через Интернет, создавая аналогичную, но другую угрозу стиля «резервного файла» для вашего приложения.

В результате эти действия генерируют файлы, которые не нужны приложению и могут обрабатываться веб-сервером иначе, чем исходный файл. Например, если мы делаем копию `login.asp` с именем `login.asp.old`, мы позволяем пользователям загружать исходный код `login.asp`. Это связано с тем, что `login.asp.old` обычно будет обслуживаться как текст или обычный текст, а не выполняться из-за его расширения. Другими словами, доступ к `login.asp` вызывает выполнение кода на стороне сервера `login.asp`, а доступ к `login.asp.old` вызывает содержимое `login.asp.old` (что опять же, код на стороне сервера) должен быть явно возвращен пользователю и отображен в браузере. Это может представлять угрозу безопасности, поскольку может быть раскрыта конфиденциальная информация.

Как правило, раскрытие кода на стороне сервера - плохая идея. Вы не только излишне разоблачаете бизнес-логику, но и можете неосознанно раскрывать информацию, связанную с приложениями, которая может помочь злоумышленнику (имена путей, структуры данных и т. Д.).). Не говоря уже о том, что в виде открытого текста слишком много сценариев со встроенным именем пользователя и паролем (что является небрежной и очень опасной практикой).

Другие причины нессылочных файлов связаны с выбором дизайна или конфигурации, когда они позволяют хранить различные типы файлов, связанных с приложениями, такие как файлы данных, файлы конфигурации, файлы журналов, в каталогах файловой системы, к которым может обращаться веб-сервер. Эти файлы обычно не имеют причин находиться в пространстве файловой системы, доступ к которому можно получить через Интернет, поскольку к ним должен обращаться только на уровне приложения, само приложение (а не случайный пользователь, просматривающий его).

### Угрозы

Старые, резервные и неотреференные файлы представляют различные угрозы безопасности веб-приложения:

- файлы без ссылок могут раскрывать конфиденциальную информацию, которая может облегчить целенаправленную атаку на приложение; например, включают файлы, содержащие учетные данные базы данных, файлы конфигурации, содержащие ссылки на другой скрытый контент, абсолютные пути к файлам и т. д.
- страницы без ссылок могут содержать мощные функции, которые можно использовать для атаки приложения; например, страница администрирования, которая не связана с опубликованным контентом, но доступна любому пользователю, который знает, где ее найти.
- Старые и резервные файлы могут содержать уязвимости, которые были исправлены в более поздних версиях; например, `viewdoc.old.jsp` может содержать уязвимость обхода каталога, которая была исправлена в `viewdoc.jsp`, но все еще может использоваться любым, кто найдет старую версию.
- Резервные файлы могут раскрывать исходный код для страниц, предназначенных для выполнения на сервере; например, запрос `viewdoc.bak` может вернуть исходный код для `viewdoc.jsp`, который можно проверить на наличие уязвимостей, которые может быть трудно найти, делая слепые запросы на исполняемую страницу. Хотя эта угроза, очевидно, применима к языкам сценариев, таким как Perl, PHP, ASP, сценарии оболочки, JSP и т. Д., это не ограничивается ими, как показано в примере, приведенном в следующей пуле.
- Резервные архивы могут содержать копии всех файлов в (или даже за пределами) webroot. Это позволяет злоумышленнику быстро перечислить все приложение, включая нереференс-страницы, исходный код, файлы и т. Д. Например, если вы забыли файл с именем `myservlets.jar.old`, содержащий (резервную копию) ваших классов реализации сервлета, вы раскрываете много конфиденциальной информации, которая подвержена декомпиляции и реверс-инжинирингу.
- В некоторых случаях копирование или редактирование файла не изменяет расширение файла, но изменяет имя файла. Это происходит, например, в средах Windows, где операции копирования файлов генерируют имена файлов с префиксом «Копия» или локализованные версии этой строки. Поскольку расширение файла остается неизменным, это не тот случай, когда исполняемый файл возвращается веб-сервером в виде простого текста, и, следовательно, не случай раскрытия исходного кода. Однако эти файлы также опасны, поскольку существует вероятность того, что они включают устаревшую и неправильную логику, которая при вызове может вызвать ошибки приложения, которые могут дать ценную информацию злоумышленнику, если отображение диагностического сообщения включено.
- Файлы журналов могут содержать конфиденциальную информацию о деятельности пользователей приложения, например, конфиденциальные данные, передаваемые в параметрах URL, идентификаторы сеанса, посещенные URL-адреса (которые могут раскрывать дополнительный неотреференный контент) и т. Д. Другие файлы журнала (например,. ftp logs) может содержать конфиденциальную информацию о поддержке приложения системными администраторами.
- Снимки файловой системы могут содержать копии кода, которые содержат уязвимости, которые были исправлены в более поздних версиях. Например, `/.snapshot/monthly.1/view.php` может содержать уязвимость обхода каталогов, которая была исправлена в `/view.php`, но все еще может использоваться любым, кто найдет старую версию.

## Цели теста

- Найти и проанализировать файлы без ссылок, которые могут содержать конфиденциальную информацию.

## Как проверить

### Тестирование черного ящика

Тестирование для файлов без ссылок использует как автоматические, так и ручные методы и обычно включает в себя комбинацию следующего:

#### Вывод из схемы именования, используемой для опубликованного контента

Перечислите все страницы и функции приложения. Это можно сделать вручную с помощью браузера или с помощью инструмента для добавления паутины. Большинство приложений используют узнаваемую схему именования и организуют ресурсы на страницы и каталоги, используя слова, которые описывают их функцию. Из схемы именования, используемой для опубликованного контента, часто можно определить имя и местоположение неотреференных страниц. Например, если страница `viewuser.asp` найдена, также найдите `edituser.asp`, `adduser.asp` и `deleteuser.asp`. Если каталог `/ app / user` найден, найдите также `/ app / admin` и `/ app / manager`.

#### Другие подсказки в опубликованном контенте

Многие веб-приложения оставляют подсказки в опубликованном контенте, что может привести к обнаружению скрытых страниц и функциональности. Эти подсказки часто появляются в исходном коде файлов HTML и JavaScript. Исходный код для всего опубликованного контента должен быть проверен вручную, чтобы определить подсказки о других страницах и функциональности. Например:

Комментарии программистов и комментируемые разделы исходного кода могут относиться к скрытому контенту:

```html
<!-- <A HREF="uploadfile.jsp">Upload a document to the server</A> -->
<!-- Link removed while bugs in uploadfile.jsp are fixed          -->
```

JavaScript может содержать ссылки на страницы, которые отображаются только в графическом интерфейсе пользователя при определенных обстоятельствах:

```javascript
var adminUser=false;
if (adminUser) menu.add (new menuItem ("Maintain users", "/admin/useradmin.jsp"));
```

HTML-страницы могут содержать FORM, которые были скрыты путем отключения элемента SUBMIT :

```html
<form action="forgotPassword.jsp" method="post">
    <input type="hidden" name="userID" value="123">
    <!-- <input type="submit" value="Forgot Password"> -->
</form>
```

Другим источником подсказок о неотреференных каталогах является файл `/robots.txt`, используемый для предоставления инструкций веб-роботам :

```html
User-agent: *
Disallow: /Admin
Disallow: /uploads
Disallow: /backup
Disallow: /~jbloggs
Disallow: /include
```

#### Слепое угадывание

В простейшей форме это включает в себя запуск списка общих имен файлов через механизм запросов в попытке угадать файлы и каталоги, которые существуют на сервере. Следующий сценарий оболочки netcat прочтет список слов из stdin и выполнит базовую атаку гадания:

```bash
#!/bin/bash

server=example.org
port=80

while read url
do
echo -ne "$url\t"
echo -e "GET /$url HTTP/1.0\nHost: $server\n" | netcat $server $port | head -1
done | tee outputfile
```

В зависимости от сервера GET может быть заменен на HEAD для более быстрых результатов. Указанный выходной файл можно пометить для «интересных» кодов ответов. Код ответа 200 (OK) обычно указывает, что действительный ресурс был найден (при условии, что сервер не предоставляет пользовательскую страницу «не найден» с использованием кода 200). Но также обратите внимание на 301 (Moved), 302 (Found), 401 (Unauthorized), 403 (Forbidden) и 500 (Внутренняя ошибка), которые также могут указывать ресурсы или каталоги, которые заслуживают дальнейшего изучения.

Базовая атака угадывания должна выполняться против webroot, а также против всех каталогов, которые были идентифицированы с помощью других методов подсчета. Более продвинутые / эффективные атаки могут быть выполнены следующим образом:

- Определите расширения файлов, используемые в известных областях приложения (например,. jsp, aspx, html) и используйте базовый список слов, прилагаемый к каждому из этих расширений (или используйте более длинный список общих расширений, если позволяют ресурсы).
- Для каждого файла, идентифицированного с помощью других методов подсчета, создайте пользовательский список слов, полученный из этого имени файла. Получить список распространенных расширений файлов (включая ~, bak, txt, src, dev, old, inc, orig, copy, tmp, swp и т. Д.).) и использовать каждое расширение до, после и вместо расширения фактического имени файла.

Примечание. Операции копирования файлов Windows генерируют имена файлов с префиксом «Копия» или локализованные версии этой строки, поэтому они не изменяют расширения файлов. Хотя файлы «Копия» обычно не раскрывают исходный код при доступе, они могут дать ценную информацию в случае, если они вызывают ошибки при вызове.

#### Информация, полученная благодаря уязвимости и неправильной конфигурации сервера

Наиболее очевидный способ, которым неверно настроенный сервер может раскрывать неотреференные страницы, - это список каталогов. Запросите все перечисленные каталоги, чтобы идентифицировать любые, которые предоставляют список каталогов.

На отдельных веб-серверах были обнаружены многочисленные уязвимости, которые позволяют злоумышленнику перечислять нереференциальный контент, например:

- Апач ?Уязвимость в списке каталогов M = D.
- Различные уязвимости раскрытия информации из исходного кода IIS.
- Уязвимости списка каталогов IIS WebDAV.

#### Использование общедоступной информации

На страницы и функции веб-приложений, обращенных к Интернету, на которые нет ссылок внутри самого приложения, можно ссылаться из других общедоступных источников. Существуют различные источники этих ссылок:

- Страницы, на которые раньше ссылались, все еще могут появляться в архивах поисковых систем Интернета. Например, `1998results.asp` больше не может быть связан с веб-сайтом компании, но может оставаться на сервере и в базах данных поисковых систем. Этот старый скрипт может содержать уязвимости, которые могут быть использованы для компрометации всего сайта. Оператор поиска `site:` Google может использоваться для запуска запроса только в отношении выбранного домена, например, в: `site: www.example.com`. Использование поисковых систем таким образом привело к широкому спектру методов, которые вы можете найти полезными и которые описаны в разделе «Google Hacking» данного руководства. Проверьте это, чтобы отточить свои навыки тестирования через Google. Файлы резервных копий вряд ли будут ссылаться на какие-либо другие файлы и, следовательно, могут не индексироваться Google, но если они лежат в каталогах с возможностью просмотра, поисковая система может знать о них.
- Кроме того, Google и Yahoo хранят кэшированные версии страниц, найденные их роботами. Даже если `1998results.asp` был удален с целевого сервера, версия его вывода все еще может храниться этими поисковыми системами. Кэшированная версия может содержать ссылки или подсказки о дополнительном скрытом контенте, который все еще остается на сервере.
- Контент, на который не ссылаются в целевом приложении, может быть связан сторонними веб-сайтами. Например, приложение, которое обрабатывает онлайн-платежи от имени сторонних трейдеров, может содержать различные индивидуальные функции, которые (обычно) можно найти только по ссылкам на веб-сайтах своих клиентов.

#### Обход фильтра имени файла

Поскольку фильтры списка запретов основаны на регулярных выражениях, иногда можно воспользоваться неясными функциями расширения имени файла ОС, которые работают так, как этого не ожидал разработчик. Тестер может иногда использовать различия в способах анализа имен файлов приложением, веб-сервером и базовой ОС, а также в соглашениях об именах файлов.

Пример: расширение имени файла Windows 8.3 `c: \\ program files` становится `C: \\ PROGRA \ ~ 1`

- Удалить несовместимые символы
- Преобразуйте пробелы в подчеркивания
- Возьмите первые шесть символов базового имени
- Добавьте `~ <digit> `, который используется для различения файлов с именами, используя те же шесть начальных символов
- Это соглашение изменяется после первых 3-ти названий
- Усечь расширение файла до трех символов
- Сделайте все персонажи заглавными

### Тестирование серой коробки

Для выполнения тестирования серого поля на старых и резервных файлах необходимо изучить файлы, содержащиеся в каталогах, принадлежащих набору веб-каталогов, обслуживаемых веб-сервером (серверами) инфраструктуры веб-приложений. Теоретически экзамен должен проводиться вручную, чтобы быть тщательным. Однако, поскольку в большинстве случаев копии файлов или файлов резервных копий, как правило, создаются с использованием одних и тех же соглашений об именах, поиск можно легко выполнить по сценарию. Например, редакторы оставляют резервные копии, называя их узнаваемым расширением или окончанием, и люди, как правило, оставляют файлы с `.old` или подобными предсказуемыми расширениями. Хорошей стратегией является периодическое планирование проверки фоновых заданий для файлов с расширениями, которые могут идентифицировать их как файлы для копирования или резервного копирования, а также выполнение ручных проверок на более длительной основе.

## Восстановление

Чтобы гарантировать эффективную стратегию защиты, тестирование должно усугубляться политикой безопасности, которая явно запрещает опасные действия, такие как:

- Редактирование файлов на месте на веб-сервере или файловых системах сервера приложений. Это особенно вредная привычка, поскольку редакторы могут создавать резервные или временные файлы. Удивительно видеть, как часто это делается, даже в крупных организациях. Если вам абсолютно необходимо редактировать файлы в производственной системе, убедитесь, что вы не оставляете ничего, что явно не предназначено, и учтите, что вы делаете это на свой страх и риск.
- Тщательно проверяйте любые другие действия, выполняемые в файловых системах, открытых веб-сервером, такие как действия по управлению точками. Например, если вам иногда нужно сделать снимок нескольких каталогов (что вам не следует делать в производственной системе), у вас может возникнуть соблазн сначала застегнуть их. Будьте осторожны, чтобы не оставить позади эти архивные файлы.
- Соответствующие политики управления конфигурацией должны помочь предотвратить устаревшие и не ссылочные файлы.
- Приложения должны быть разработаны таким образом, чтобы не создавать (или полагаться на) файлы, хранящиеся в деревьях веб-каталогов, обслуживаемых веб-сервером. Файлы данных, файлы журналов, файлы конфигурации и т. Д. должны храниться в каталогах, недоступных веб-серверу, чтобы противостоять возможности раскрытия информации (не говоря уже об изменении данных, если разрешения веб-каталогов позволяют писать).
- Снимки файловой системы не должны быть доступны через Интернет, если корень документа находится в файловой системе, использующей эту технологию. Настройте свой веб-сервер, чтобы запретить доступ к таким каталогам, например, в Apache должна использоваться директива о местоположении, такая как эта

```xml
<Location ~ ".snapshot">
    Order deny,allow
    Deny from all
</Location>
```

## Инструменты

Инструменты оценки уязвимости, как правило, включают проверки для обнаружения веб-каталогов со стандартными именами (например, «admin», «test», «backup» и т. Д.).) и сообщать о любом веб-каталоге, который позволяет индексировать. Если вы не можете получить какой-либо список каталогов, вам следует попытаться проверить возможные расширения резервного копирования. Проверьте например

- [Nessus](https://www.tenable.com/products/nessus)
- [Nikto2](https://cirt.net/Nikto2)

Web spider tools

- [wget](https://www.gnu.org/software/wget/)
- [Wget for Windows](http://www.interlog.com/~tcharron/wgetwin.html)
- [Sam Spade](https://web.archive.org/web/20090926061558/http://preview.samspade.org/ssw/download.html)
- [Spike proxy includes a web site crawler function](https://www.spikeproxy.com/)
- [Xenu](http://home.snafu.de/tilman/xenulink.html)
- [curl](https://curl.haxx.se)

Некоторые из них также включены в стандартные дистрибутивы Linux. Инструменты веб-разработки обычно включают средства для идентификации неработающих ссылок и нессылочных файлов.
