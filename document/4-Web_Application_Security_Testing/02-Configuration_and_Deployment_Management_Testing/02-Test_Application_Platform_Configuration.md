# Тестовая конфигурация платформы приложения

|ID          |
|------------|
|WSTG-CONF-02|

## Резюме

Правильная конфигурация отдельных элементов, составляющих архитектуру приложения, важна для предотвращения ошибок, которые могут поставить под угрозу безопасность всей архитектуры.

Проверка и тестирование конфигурации является важной задачей при создании и поддержании архитектуры. Это связано с тем, что многие различные системы обычно будут снабжены общими конфигурациями, которые могут не соответствовать задаче, которую они будут выполнять на конкретном сайте, на котором они установлены.

Хотя типичная установка веб-сервера и сервера приложений будет содержать много функций (например, примеры приложений, документация, тестовые страницы), что не обязательно, следует удалять перед развертыванием, чтобы избежать эксплуатации после установки.

## Цели теста

- Убедитесь, что настройки по умолчанию и известные файлы были удалены.
- Убедитесь, что в производственных средах не осталось кода отладки или расширений.
- Просмотрите механизмы регистрации, установленные для приложения.

## Как проверить

### Тестирование черного ящика

#### Образец и известные файлы и каталоги

Многие веб-серверы и серверы приложений предоставляют при установке по умолчанию образцы приложений и файлов в интересах разработчика и для проверки правильности работы сервера сразу после установки. Однако позже стало известно, что многие приложения веб-сервера по умолчанию уязвимы. Это был случай, например, для CVE-1999-0449 (Отказ в обслуживании в IIS, когда был установлен образец сайта Exair) CAN-2002-1744 (Уязвимость обхода каталога в CodeBrws.asp в Microsoft IIS 5.0) CAN-2002-1630 (Использование sendmail.jsp в Oracle 9iAS) или CAN-2003-1172 (Обход каталога в образце источника просмотра в Apache Cocoon).

Сканеры CGI включают подробный список известных файлов и образцов каталогов, которые предоставляются различными веб-серверами или серверами приложений, и могут быть быстрым способом определить, присутствуют ли эти файлы. Однако единственный способ быть уверенным - это сделать полный обзор содержимого веб-сервера или сервера приложений и определить, связаны ли они с самим приложением или нет.

#### Комментарий Обзор

Программисты очень часто добавляют комментарии при разработке крупных веб-приложений. Однако комментарии, включенные в встроенный код HTML, могут раскрывать внутреннюю информацию, которая не должна быть доступна злоумышленнику. Иногда даже исходный код комментируется, поскольку функциональность больше не требуется, но этот комментарий просочится на HTML-страницы, непреднамеренно возвращаемые пользователям.

Обзор комментариев должен быть сделан, чтобы определить, просочилась ли какая-либо информация через комментарии. Этот обзор может быть полностью выполнен только путем анализа статического и динамического содержимого веб-сервера и поиска файлов. Может быть полезно просматривать сайт автоматически или с гидом и хранить весь полученный контент. Этот восстановленный контент затем можно искать, чтобы проанализировать любые комментарии HTML, доступные в коде.

#### Конфигурация системы

Различные инструменты, документы или контрольные списки могут использоваться для предоставления специалистам в области ИТ и безопасности подробной оценки соответствия целевых систем различным базовым показателям или контрольным показателям конфигурации. Такие инструменты включают (но не ограничиваются ими):

- [CIS-CAT Lite](https://www.cisecurity.org/blog/introducing-cis-cat-lite/)
- [Microsoft's Attack Surface Analyzer](https://github.com/microsoft/AttackSurfaceAnalyzer)
- [NIST's National Checklist Program](https://nvd.nist.gov/ncp/repository)

### Тестирование серой коробки

#### Обзор конфигурации

Конфигурация веб-сервера или сервера приложений играет важную роль в защите содержимого сайта, и ее необходимо тщательно проверять, чтобы обнаружить распространенные ошибки конфигурации. Очевидно, что рекомендуемая конфигурация варьируется в зависимости от политики сайта и функциональности, которая должна предоставляться серверным программным обеспечением. Однако в большинстве случаев следует соблюдать рекомендации по конфигурации (предоставленные поставщиком программного обеспечения или внешними сторонами), чтобы определить, был ли сервер должным образом защищен.

Невозможно в общих чертах сказать, как должен быть настроен сервер, однако следует учитывать некоторые общие рекомендации:

- Включите только серверные модули (расширения ISAPI в случае IIS), которые необходимы для приложения. Это уменьшает поверхность атаки, поскольку размер и сложность сервера уменьшены по мере отключения программных модулей. Это также предотвращает воздействие на сайт уязвимостей, которые могут появляться в программном обеспечении поставщика, если они присутствуют только в модулях, которые уже отключены.
- Обработка ошибок сервера (40x или 50x) с помощью пользовательских страниц, а не с страницами веб-сервера по умолчанию. В частности, убедитесь, что любые ошибки приложения не будут возвращены конечному пользователю и что через эти ошибки не будет пропущен код, поскольку он поможет злоумышленнику. На самом деле очень часто забывают об этом, поскольку разработчики действительно нуждаются в этой информации в среде подготовки к производству.
- Убедитесь, что серверное программное обеспечение работает с минимальными привилегиями в операционной системе. Это предотвращает прямую компрометацию всей системы с помощью серверного программного обеспечения, хотя злоумышленник может повысить привилегии при запуске кода в качестве веб-сервера.
- Убедитесь, что серверное программное обеспечение правильно регистрирует как законный доступ, так и ошибки.
- Убедитесь, что сервер настроен на правильную обработку перегрузок и предотвращение атак типа «отказ в обслуживании». Убедитесь, что сервер настроен правильно.
- Никогда не предоставляйте неадминистративным идентификаторам (за исключением `NT SERVICE \ WMSvc`) доступ к applicationHost.config, redirection.config и administration.config (доступ для чтения или записи). Это включает в себя «Сетевое обслуживание», «IIS_IUSRS», «IUSR» или любые пользовательские идентификаторы, используемые пулами приложений IIS. Рабочие процессы IIS не предназначены для прямого доступа к любому из этих файлов.
- Никогда не делитесь applicationHost.config, redirection.config и administration.config в сети. При использовании общей конфигурации предпочитайте экспортировать applicationHost.config в другое место (см. Раздел «Настройка разрешений для общей конфигурации»).
- Имейте в виду, что все пользователи могут по умолчанию читать файлы .NET Framework `machine.config` и root `web.config`. Не храните конфиденциальную информацию в этих файлах, если это должно быть только для глаз администратора.
- Шифровать конфиденциальную информацию, которая должна считываться только рабочими процессами IIS, а не другими пользователями на компьютере.
- Не предоставляйте доступ к записи с идентификатором, который веб-сервер использует для доступа к общему `applicationHost.config`. Эта личность должна иметь только доступ для чтения.
- Используйте отдельную идентификацию для публикации приложения Host.config к акции. Не используйте этот идентификатор для настройки доступа к общей конфигурации на веб-серверах.
- Используйте надежный пароль при экспорте ключей шифрования для использования с общей конфигурацией.
- Поддерживать ограниченный доступ к общему ресурсу, содержащему общие ключи конфигурации и шифрования. Если этот общий ресурс скомпрометирован, злоумышленник сможет читать и записывать любую конфигурацию IIS для ваших веб-серверов, перенаправлять трафик с вашего веб-сайта на вредоносные источники и в некоторых случаях получить контроль над всеми веб-серверами, загружая произвольный код в работника IIS. процессы.
- Подумайте о защите этого ресурса с помощью правил брандмауэра и политик IPsec, чтобы разрешить подключение только веб-серверов-членов.

#### Регистрация

Регистрация является важным активом безопасности архитектуры приложения, поскольку она может использоваться для обнаружения недостатков в приложениях (пользователи постоянно пытаются получить файл, который на самом деле не существует), а также для устойчивых атак со стороны мошеннических пользователей. Журналы обычно правильно генерируются веб-и другим серверным программным обеспечением. Нередко можно найти приложения, которые должным образом регистрируют свои действия в журнале, и, когда они это делают, основное намерение журналов приложений состоит в том, чтобы создать выходные данные отладки, которые могут использоваться программистом для анализа конкретной ошибки.

В обоих случаях (журналы сервера и приложения) несколько проблем должны быть проверены и проанализированы на основе содержимого журнала:

1. Содержит ли журналы конфиденциальную информацию?
2. Хранятся ли журналы на выделенном сервере?
3. Может ли использование журнала генерировать условие отказа в обслуживании?
4. Как они вращаются? Хранятся ли журналы в течение достаточного времени?
5. Как рассматриваются журналы? Могут ли администраторы использовать эти обзоры для обнаружения целевых атак?
6. Как сохраняются резервные копии журналов?
7. Проверяются ли данные зарегистрированными данными (минимальная / максимальная длина, символы и т. Д.) До регистрации?

##### Чувствительная информация в журналах

Некоторые приложения могут, например, использовать запросы GET для пересылки данных формы, которые будут отображаться в журналах сервера. Это означает, что журналы сервера могут содержать конфиденциальную информацию (например, имена пользователей в качестве паролей или данные банковского счета). Эта конфиденциальная информация может быть использована злоумышленником, если он получил журналы, например, через административные интерфейсы или известные уязвимости веб-сервера или неправильную конфигурацию (например, хорошо известная неправильная конфигурация `server-status` на HTTP-серверах на основе Apache).

Журналы событий часто будут содержать данные, которые полезны для злоумышленника (утечка информации) или могут использоваться непосредственно в эксплойтах :

- Отладка информации
- Стек следы
- имена пользователей
- Имена компонентов системы
- Внутренние IP-адреса
- Менее конфиденциальные личные данные (например,. адреса электронной почты, почтовые адреса и номера телефонов, связанные с именными лицами)
- Деловые данные

Кроме того, в некоторых юрисдикциях хранение некоторой конфиденциальной информации в файлах журналов, таких как личные данные, может обязать предприятие применять законы о защите данных, которые они будут применять к своим внутренним базам данных, также к файлам журналов. И неспособность сделать это, даже неосознанно, может повлечь за собой штрафы в соответствии с действующим законодательством о защите данных.

Более широкий список конфиденциальной информации:

- Исходный код приложения
- Значения идентификации сеанса
- Доступ к токенам
- Чувствительные личные данные и некоторые формы личной информации (PII)
- Аутентификация паролей
- Строки подключения к базе данных
- Ключи шифрования
- Данные банковского счета или держателя платежной карты
- Данные более высокой классификации безопасности, чем система регистрации, разрешено хранить
- Коммерчески конфиденциальная информация
- Информация, которую незаконно собирать в соответствующей юрисдикции
- Информация, которую пользователь отказался от сбора или не согласился, например,. использование не отслеживается, или когда истек срок действия согласия на сбор

#### Местоположение журнала

Обычно серверы генерируют локальные журналы своих действий и ошибок, потребляя диск системы, на которой работает сервер. Однако, если сервер скомпрометирован, злоумышленник может уничтожить его журналы, чтобы очистить все следы его атаки и методы. Если бы это произошло, системный администратор не знал бы, как произошла атака или где находился источник атаки. Фактически, большинство наборов инструментов злоумышленника включают в себя «log zapper», который способен очищать любые журналы, которые содержат заданную информацию (например, IP-адрес злоумышленника) и обычно используются в корневых наборах системного уровня злоумышленника.

Следовательно, разумнее хранить журналы в отдельном месте, а не на самом веб-сервере. Это также облегчает агрегирование журналов из разных источников, которые ссылаются на одно и то же приложение (например, на ферме веб-серверов), а также облегчает анализ журналов (который может быть интенсивным для процессора), не затрагивая сам сервер.

#### Хранилище журналов

Журналы могут вводить условие отказа в обслуживании, если они не хранятся должным образом. Любой злоумышленник, обладающий достаточными ресурсами, может быть в состоянии выполнить достаточное количество запросов, которые заполнят выделенное пространство для файлов журналов, если они специально не лишены возможности сделать это. Однако, если сервер не настроен должным образом, файлы журнала будут храниться в том же разделе диска, что и раздел, используемый для программного обеспечения операционной системы или самого приложения. Это означает, что если диск будет заполнен, операционная система или приложение может выйти из строя, потому что оно не может записать на диск.

Как правило, в системах UNIX журналы будут находиться в / var (хотя некоторые серверные установки могут находиться в / opt или / usr / local), и важно убедиться, что каталоги, в которых хранятся журналы, находятся в отдельном разделе. В некоторых случаях, чтобы предотвратить влияние системных журналов, каталог журналов самого серверного программного обеспечения (такого как / var / log / apache на веб-сервере Apache) должен храниться в специальном разделе.

Это не означает, что журналы должны быть разрешены для увеличения, чтобы заполнить файловую систему, в которой они находятся. Для обнаружения этого условия следует отслеживать рост журналов сервера, поскольку это может указывать на атаку.

Тестирование этого условия так же просто и опасно в производственных средах, как и выполнение достаточного и устойчивого количества запросов, чтобы увидеть, регистрируются ли эти запросы и есть ли возможность заполнить раздел журнала с помощью этих запросов. В некоторых средах параметры QUERY_STRING также регистрируются независимо от того, создаются ли они с помощью запросов GET или POST, большие запросы могут быть смоделированы, что с тех пор заполнит журналы быстрее, как правило, один запрос приведет к регистрации только небольшого количества данных, такие как дата и время, IP-адрес источника, Запрос URI, и результат сервера.

#### Ротация журнала

Большинство серверов (но мало пользовательских приложений) будут вращать журналы, чтобы они не могли заполнить файловую систему, в которой они находятся. При вращении журналов предполагается, что информация в них необходима только в течение ограниченного периода времени.

Эта функция должна быть проверена, чтобы гарантировать, что :

- Журналы хранятся в течение времени, определенного в политике безопасности, не больше и не меньше.
- Журналы сжимаются после вращения (это удобно, поскольку это будет означать, что больше журналов будет храниться для того же доступного дискового пространства).
- Разрешение файловой системы на файлы с поворотным журналом такое же (или более строгое), как и у самих файлов журнала. Например, веб-серверам нужно будет записывать в журналы, которые они используют, но на самом деле им не нужно писать в повернутые журналы, что означает, что разрешения файлов могут быть изменены при вращении, чтобы предотвратить их изменение в процессе веб-сервера.

Некоторые серверы могут вращать журналы, когда они достигают заданного размера. Если это произойдет, необходимо убедиться, что злоумышленник не может заставить журналы вращаться, чтобы скрыть свои следы.

#### Управление доступом к журналу

Информация журнала событий никогда не должна быть видна конечным пользователям. Даже веб-администраторы не должны видеть такие журналы, поскольку они нарушают разделение дежурного контроля. Убедитесь, что любая схема контроля доступа, которая используется для защиты доступа к необработанным журналам, и любые приложения, предоставляющие возможности для просмотра или поиска журналов, не связаны со схемами контроля доступа для других ролей пользователя приложения. Также не должны быть доступны данные журнала для не аутентифицированных пользователей.

#### Обзор журнала

Просмотр журналов может использоваться не только для извлечения статистики использования файлов на веб-серверах (на которой обычно сосредоточено большинство приложений на основе журналов), но и для определения того, происходят ли атаки на веб-сервере.

Для анализа атак на веб-сервер необходимо проанализировать файлы журнала ошибок сервера. Обзор должен сосредоточиться на:

- 40x (не найдено) сообщений об ошибках. Большое количество из них из одного и того же источника может свидетельствовать о том, что инструмент CGI-сканера используется против веб-сервера
- 50x (ошибка сервера) сообщений. Это может быть признаком того, что злоумышленник злоупотребляет частями приложения, которые неожиданно выходят из строя. Например, первые фазы атаки SQL-инъекции будут создавать это сообщение об ошибке, когда запрос SQL не будет правильно построен и его выполнение не удастся в базе данных бэк-энда.

Статистика или анализ журналов не должны генерироваться или храниться на том же сервере, который создает журналы. В противном случае злоумышленник может через уязвимость веб-сервера или неправильную конфигурацию получить к ним доступ и получить аналогичную информацию, которая будет раскрыта самими файлами журналов.

## References

- Apache
    - Apache Security, by Ivan Ristic, O’reilly, March 2005.
    - [Apache Security Secrets: Revealed (Again), Mark Cox, November 2003](https://awe.com/mark/talks/apachecon2003us.html)
    - [Apache Security Secrets: Revealed, ApacheCon 2002, Las Vegas, Mark J Cox, October 2002](https://awe.com/mark/talks/apachecon2002us.html)
    - [Performance Tuning](https://httpd.apache.org/docs/current/misc/perf-tuning.html)
- Lotus Domino
    - Lotus Security Handbook, William Tworek et al., April 2004, available in the IBM Redbooks collection
    - Lotus Domino Security, an X-force white-paper, Internet Security Systems, December 2002
    - Hackproofing Lotus Domino Web Server, David Litchfield, October 2001
- Microsoft IIS
    - [Security Best Practices for IIS 8](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj635855(v=ws.11))
    - [CIS Microsoft IIS Benchmarks](https://www.cisecurity.org/benchmark/microsoft_iis/)
    - Securing Your Web Server (Patterns and Practices), Microsoft Corporation, January 2004
    - IIS Security and Programming Countermeasures, by Jason Coombs
    - From Blueprint to Fortress: A Guide to Securing IIS 5.0, by John Davis, Microsoft Corporation, June 2001
    - Secure Internet Information Services 5 Checklist, by Michael Howard, Microsoft Corporation, June 2000
- Red Hat’s (formerly Netscape’s) iPlanet
    - Guide to the Secure Configuration and Administration of iPlanet Web Server, Enterprise Edition 4.1, by James M Hayes, The Network Applications Team of the Systems and Network Attack Center (SNAC), NSA, January 2001
- WebSphere
    - IBM WebSphere V5.0 Security, WebSphere Handbook Series, by Peter Kovari et al., IBM, December 2002.
    - IBM WebSphere V4.0 Advanced Edition Security, by Peter Kovari et al., IBM, March 2002.
- General
    - [Logging Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Logging_Cheat_Sheet.html), OWASP
    - [SP 800-92](https://csrc.nist.gov/publications/detail/sp/800-92/final) Guide to Computer Security Log Management, NIST
    - [PCI DSS v3.2.1](https://www.pcisecuritystandards.org/document_library) Requirement 10 and PA-DSS v3.2 Requirement 4, PCI Security Standards Council

- Generic:
    - [CERT Security Improvement Modules: Securing Public Web Servers](https://resources.sei.cmu.edu/asset_files/SecurityImprovementModule/2000_006_001_13637.pdf)
