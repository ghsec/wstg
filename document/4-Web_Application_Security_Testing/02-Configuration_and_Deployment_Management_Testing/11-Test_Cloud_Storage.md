# Тестовое облачное хранилище

| ID |
| ------------- |
| WSTG-CONF-11 |

## Резюме

Службы облачного хранения облегчают использование веб-приложений и услуг для хранения и доступа к объектам в службе хранения. Однако неправильная конфигурация контроля доступа может привести к конфиденциальному раскрытию информации, подделке данных или несанкционированному доступу.

Известный пример - когда ведро Amazon S3 неправильно сконфигурировано, хотя другие службы облачного хранилища также могут подвергаться аналогичным рискам. По умолчанию все ведра S3 являются частными и доступны только пользователям, которым явно предоставлен доступ. Пользователи могут предоставить публичный доступ как к самому ведру, так и к отдельным объектам, хранящимся в этом ведре. Это может привести к тому, что неавторизованный пользователь сможет загружать новые файлы, изменять или читать сохраненные файлы.

## Цели теста

- Оцените, что конфигурация контроля доступа для служб хранения правильно установлена.

## Как проверить

Сначала определите URL-адрес для доступа к данным в службе хранения, а затем рассмотрите следующие тесты:

- читать несанкционированные данные
- загрузить новый произвольный файл

Вы можете использовать curl для тестов со следующими командами и посмотреть, могут ли несанкционированные действия быть успешно выполнены.

Чтобы проверить способность читать объект :

```bash
curl -X GET https://<cloud-storage-service>/<object>
```

Чтобы проверить возможность загрузки файла :

```bash
curl -X PUT -d 'test' 'https://<cloud-storage-service>/test.txt'
```

### Тестирование на амазонку S3 Bucket Misconfiguration

URL-адреса ведра Amazon S3 следуют одному из двух форматов: виртуальный стиль хоста или стиль пути.

- Виртуальный хостинг Стиль доступа

```text
https://bucket-name.s3.Region.amazonaws.com/key-name
```

В следующем примере `my-bucket` - это имя ведра, `us-west-2` - это регион, а `puppy.png` - это имя ключа:

```text
https://my-bucket.s3.us-west-2.amazonaws.com/puppy.png
```

- Path-Style Access

```text
https://s3.Region.amazonaws.com/bucket-name/key-name
```

Как и выше, в следующем примере `my-bucket` - это имя ведра, `us-west-2` - это регион, а `puppy.png` - это имя ключа:

```text
https://s3.us-west-2.amazonaws.com/my-bucket/puppy.jpg
```

Для некоторых регионов можно использовать устаревшую глобальную конечную точку, которая не указывает конкретную для региона конечную точку. Его формат также является виртуальным стилем или стилем пути.

- Virtual Hosted Style Access

```text
https://bucket-name.s3.amazonaws.com
```

- Path-Style Access

```text
https://s3.amazonaws.com/bucket-name
```

#### Определите URL ведра

Для тестирования черного ящика URL-адреса S3 можно найти в сообщениях HTTP. В следующем примере показан URL-адрес ведра, отправляемый в теге `img` в ответе HTTP.

```html
...
<img src="https://my-bucket.s3.us-west-2.amazonaws.com/puppy.png">
...
```

Для тестирования «серых ящиков» вы можете получить URL-адреса ведра из веб-интерфейса Amazon, документов, исходного кода или любых других доступных источников.

#### Тестирование с AWS-CLI

Помимо тестирования с помощью завивки, вы также можете протестировать с помощью инструмента командной строки AWS. В этом случае используется протокол `s3: //`.

##### Список

Следующая команда перечисляет все объекты ведра, когда оно настроено общедоступно.

```bash
aws s3 ls s3://<bucket-name>
```

##### Загрузить

Ниже приведена команда загрузки файла

```bash
aws s3 cp arbitrary-file s3://bucket-name/path-to-save
```

Этот пример показывает результат, когда загрузка прошла успешно.

```bash
$ aws s3 cp test.txt s3://bucket-name/test.txt
upload: ./test.txt to s3://bucket-name/test.txt
```

Этот пример показывает результат, когда загрузка не удалась.

```bash
$ aws s3 cp test.txt s3://bucket-name/test.txt
upload failed: ./test2.txt to s3://bucket-name/test2.txt An error occurred (AccessDenied) when calling the PutObject operation: Access Denied
```

##### Удалить

Ниже приведена команда удаления объекта

```bash
aws s3 rm s3://bucket-name/object-to-remove
```

## Tools

- [AWS CLI](https://aws.amazon.com/cli/)

## References

- [Working with Amazon S3 Buckets](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html)
- [flAWS 2](http://flaws2.cloud)
