# Обработка расширений тестовых файлов для конфиденциальной информации

|ID          |
|------------|
|WSTG-CONF-03|

## Резюме

Расширения файлов обычно используются на веб-серверах, чтобы легко определить, какие технологии, языки и плагины должны использоваться для выполнения веб-запроса. Хотя это поведение согласуется с RFC и веб-стандартами, использование стандартных расширений файлов предоставляет тестеру проникновения полезную информацию о базовых технологиях, используемых в веб-приборе, и значительно упрощает задачу определения сценария атаки, который будет использоваться на определенных технологиях. Кроме того, неправильная конфигурация веб-серверов может легко раскрыть конфиденциальную информацию о учетных данных доступа.

Проверка расширения часто используется для проверки загружаемых файлов, что может привести к неожиданным результатам, поскольку содержание не соответствует ожидаемому, или из-за неожиданной обработки имени файла ОС.

Определение того, как веб-серверы обрабатывают запросы, соответствующие файлам с разными расширениями, может помочь в понимании поведения веб-сервера в зависимости от типа файлов, к которым осуществляется доступ. Например, это может помочь понять, какие расширения файлов возвращаются как текстовые или простые по сравнению с теми, которые вызывают выполнение на стороне сервера. Последние указывают на технологии, языки или плагины, которые используются веб-серверами или серверами приложений, и могут дать дополнительное представление о том, как разрабатывается веб-приложение. Например, расширение «.pl» обычно связано с поддержкой Perl на стороне сервера. Однако одно расширение файла может быть обманчивым и не полностью убедительным. Например, ресурсы на стороне сервера Perl могут быть переименованы, чтобы скрыть тот факт, что они действительно связаны с Perl. См. Следующий раздел «Компоненты веб-сервера», чтобы узнать больше об идентификации технологий и компонентов на стороне сервера.

## Цели теста

- Дирбуст-чувствительные расширения файлов или расширения, которые могут содержать необработанные данные (* например,.* сценарии, необработанные данные, учетные данные и т. д.).
- Убедитесь, что в установленных правилах не существует обходов системной структуры.

## Как проверить

### Принудительный просмотр

Отправляйте запросы с различными расширениями файлов и проверяйте, как они обрабатываются. Проверка должна проводиться для каждого веб-каталога. Проверьте каталоги, которые позволяют выполнение скрипта. Каталоги веб-сервера можно идентифицировать с помощью инструментов сканирования, которые ищут наличие известных каталогов. Кроме того, зеркалирование структуры веб-сайта позволяет тестеру реконструировать дерево веб-каталогов, обслуживаемых приложением.

Если архитектура веб-приложений сбалансирована по нагрузке, важно оценить все веб-серверы. Это может быть или не быть легко, в зависимости от конфигурации балансирующей инфраструктуры. В инфраструктуре с избыточными компонентами могут быть небольшие изменения в конфигурации отдельных веб-серверов или серверов приложений. Это может произойти, если в веб-архитектуре используются гетерогенные технологии (вспомните набор веб-серверов IIS и Apache в конфигурации балансировки нагрузки, которая может привести к незначительному асимметричному поведению между ними и, возможно, к различным уязвимостям).

#### Пример

Тестер идентифицировал существование файла с именем `connection.inc`. Попытка получить к нему доступ напрямую возвращает его содержимое, которое:

```php
<?
    mysql_connect("127.0.0.1", "root", "password")
        or die("Could not connect");
?>
```

Тестер определяет наличие бэк-энда СУБД MySQL и (слабых) учетных данных, используемых веб-приложением для доступа к нему.

Следующие расширения файлов никогда не должны возвращаться веб-сервером, поскольку они связаны с файлами, которые могут содержать конфиденциальную информацию, или с файлами, для которых нет причин для обслуживания.

- `.asa`
- `.inc`
- `.config`

Следующие расширения файлов связаны с файлами, которые при доступе отображаются или загружаются браузером. Поэтому файлы с этими расширениями должны быть проверены, чтобы убедиться, что они действительно должны быть обработаны (и не являются остатками), и что они не содержат конфиденциальную информацию.

- `.zip`, `.tar`, `.gz`, `.tgz`, `.rar` и т. Д.: (Сжатые) архивные файлы
- `.java`: нет причин предоставлять доступ к исходным файлам Java
- `.txt`: текстовые файлы
- `.pdf`: документы PDF
- `.docx`, `.rtf`, `.xlsx`, `.pptx` и т. Д.: Офисные документы
- `.bak`, `.old` и другие расширения, указывающие на файлы резервных копий (например: `~` для файлов резервных копий Emacs)

Приведенный выше список детализирует только несколько примеров, поскольку расширений файлов слишком много, чтобы их можно было всесторонне обработать здесь. Обратитесь к [FILExt](https://filext.com/) для более тщательной базы данных расширений.

Для идентификации файлов, имеющих заданные расширения, можно использовать сочетание методов. Эти методы могут включать в себя сканеры уязвимости, инструменты для раскроя и зеркалирования, ручную проверку приложения (это преодолевает ограничения в автоматическом расклеивании), запрос поисковых систем (см [Testing: Spidering and googling](../01-Information_Gathering/01-Conduct_Search_Engine_Discovery_Reconnaissance_for_Information_Leakage.md)). Смотрите также [Testing for Old, Backup and Unreferenced Files](04-Review_Old_Backup_and_Unreferenced_Files_for_Sensitive_Information.md) который занимается вопросами безопасности, связанными с «забытыми» файлами.

### Загрузка файла

Устаревшая обработка файлов Windows 8.3 иногда может использоваться для поражения фильтров загрузки файлов.

Примеры использования:

1. `file.phtml` обрабатывается как код PHP.
2. `FILE ~ 1.PHT` обслуживается, но не обрабатывается обработчиком PHP ISAPI.
3. `shell.phPWND` можно загрузить.
4. `SHELL ~ 1.PHP` будет расширен и возвращен оболочкой ОС, а затем обработан обработчиком PHP ISAPI.

### Тестирование серой коробки

Выполнение тестирования «белого ящика» с обработкой расширений файлов сводится к проверке конфигураций веб-серверов или серверов приложений, участвующих в архитектуре веб-приложений, и проверке их инструкций по обслуживанию различных расширений файлов.

Если веб-приложение опирается на гетерогенную инфраструктуру, сбалансированную по нагрузке, определите, может ли это привести к другому поведению.

## Инструменты

Сканеры уязвимости, такие как Nessus и Nikto, проверяют наличие известных веб-каталогов. Они могут позволить тестеру загрузить структуру веб-сайта, что полезно при попытке определить конфигурацию веб-каталогов и порядок обслуживания отдельных расширений файлов. Другие инструменты, которые можно использовать для этой цели, включают в себя:

- [wget](https://www.gnu.org/software/wget)
- [curl](https://curl.haxx.se)
- google for "web mirroring tools".
