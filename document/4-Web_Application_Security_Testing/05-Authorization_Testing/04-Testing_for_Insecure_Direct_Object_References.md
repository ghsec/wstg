# Тестирование на небезопасные прямые ссылки на объекты

| ID |
| ------------- |
| WSTG-ATHZ-04 |

## Резюме

Небезопасные ссылки на прямые объекты (IDOR) возникают, когда приложение обеспечивает прямой доступ к объектам на основе пользовательских данных. В результате этой уязвимости злоумышленники могут напрямую обходить ресурсы авторизации и доступа к системе, например, записи базы данных или файлы.
Небезопасные ссылки на прямые объекты позволяют злоумышленникам обходить ресурсы авторизации и доступа напрямую, изменяя значение параметра, используемого для непосредственного указания на объект. Такими ресурсами могут быть записи базы данных, принадлежащие другим пользователям, файлы в системе и многое другое. Это вызвано тем, что приложение принимает предоставленный пользователем ввод и использует его для извлечения объекта без проведения достаточных проверок авторизации.

## Цели теста

- Определите точки, где могут происходить ссылки на объекты.
- Оцените меры контроля доступа и, если они уязвимы для IDOR .

## Как проверить

Чтобы проверить эту уязвимость, тестер должен сначала отобразить все места в приложении, где пользовательский ввод используется для прямой ссылки на объекты. Например, места, где пользовательский ввод используется для доступа к строке базы данных, файлу, страницам приложения и т. Д. Затем тестер должен изменить значение параметра, используемого для ссылки на объекты, и оценить, возможно ли извлечь объекты, принадлежащие другим пользователям, или иным образом обойти авторизацию.

Лучший способ проверить прямые ссылки на объекты - иметь как минимум двух (часто более) пользователей для охвата различных принадлежащих объектов и функций. Например, два пользователя, каждый из которых имеет доступ к различным объектам (таким как информация о покупке, личные сообщения и т. Д.).) и (при необходимости) пользователи с различными привилегиями (например, пользователи администратора), чтобы увидеть, есть ли прямые ссылки на функциональность приложения. Имея несколько пользователей, тестер экономит драгоценное время тестирования при угадывании различных имен объектов, поскольку он может пытаться получить доступ к объектам, принадлежащим другому пользователю.

Ниже приведены несколько типичных сценариев для этой уязвимости и методы для тестирования для каждого:

### Значение параметра используется непосредственно для получения записи базы данных

Образец запроса:

```text
http://foo.bar/somepage?invoice=12345
```

В этом случае значение параметра * invoice * используется в качестве индекса в таблице счетов в базе данных. Приложение принимает значение этого параметра и использует его в запросе к базе данных. Затем приложение возвращает информацию счета пользователю.

Поскольку значение * счета * попадает непосредственно в запрос, путем изменения значения параметра можно получить любой объект счета, независимо от пользователя, которому принадлежит счет. Чтобы проверить это, тестер должен получить идентификатор счета-фактуры, принадлежащего другому пользователю-тесту (утверждая, что он не должен просматривать эту информацию в соответствии с бизнес-логикой приложения), а затем проверить, возможно ли получить доступ к объектам без авторизации.

### Значение параметра используется непосредственно для выполнения операции в системе

Образец запроса:

```text
http://foo.bar/changepassword?user=someuser
```

В этом случае значение параметра `user` используется для указания приложению, для какого пользователя он должен изменить пароль. Во многих случаях этот шаг будет частью мастера или многоступенчатой операции. На первом этапе приложение получит запрос с указанием, какой пароль пользователя должен быть изменен, а на следующем шаге пользователь предоставит новый пароль (без запроса текущего).

Параметр `user` используется для прямой ссылки на объект пользователя, для которого будет выполнена операция изменения пароля. Чтобы проверить это, тестер должен попытаться предоставить другое имя пользователя теста, чем тот, который в данный момент зарегистрирован, и проверить, можно ли изменить пароль другого пользователя.

### Значение параметра используется непосредственно для извлечения ресурса файловой системы

Образец запроса:

```text
http://foo.bar/showImage?img=img00011
```

В этом случае значение параметра `file` используется для указания приложению, какой файл пользователь намеревается извлечь. Предоставляя имя или идентификатор другого файла (например, file = image00012.jpg), злоумышленник сможет извлекать объекты, принадлежащие другим пользователям.

Чтобы проверить это дело, тестер должен получить ссылку, к которой пользователь не должен иметь доступ, и попытаться получить к ней доступ, используя ее в качестве значения `file` параметр. Примечание. Эта уязвимость часто используется в сочетании с уязвимостью, связанной с каталогом / путем пересечения (см [Testing for Path Traversal](01-Testing_Directory_Traversal_File_Include.md))

### Значение параметра используется непосредственно для доступа к функциональности приложения

Образец запроса:

```text
http://foo.bar/accessPage?menuitem=12
```

В этом случае значение параметра `menuitem` используется для указания приложению, к какому пункту меню (и, следовательно, к каким функциям приложения) пользователь пытается получить доступ. Предположим, что пользователь ограничен и поэтому имеет ссылки, доступные только для доступа к пунктам меню 1, 2 и 3. Изменяя значение параметра `menuitem`, можно обойти авторизацию и получить доступ к дополнительным функциям приложения. Чтобы проверить это, тестер определяет место, где функциональность приложения определяется ссылкой на пункт меню, отображает значения пунктов меню, к которым может получить доступ данный тестовый пользователь, а затем пытается другие пункты меню.

В приведенных выше примерах достаточно модификации одного параметра. Однако иногда ссылка на объект может быть разделена между несколькими параметрами, и тестирование должно быть соответствующим образом скорректировано.

## References

[Top 10 2013-A4-Insecure Direct Object References](https://owasp.org/www-project-top-ten/2017/Release_Notes)
