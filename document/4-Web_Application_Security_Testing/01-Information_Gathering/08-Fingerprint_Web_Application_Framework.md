# Fingerprint Web Application Framework

|ID          |
|------------|
|WSTG-INFO-08|

## Резюме

Под солнцем нет ничего нового, и почти каждое веб-приложение, которое можно придумать, уже разработано. С огромным количеством бесплатных и открытых программных проектов, которые активно разрабатываются и развертываются по всему миру, весьма вероятно, что тест безопасности приложения столкнется с целью, которая полностью или частично зависит от этих хорошо известных приложений или структур (например,. WordPress, phpBB, Mediawiki и т. Д.). Знание тестируемых компонентов веб-приложения значительно помогает в процессе тестирования, а также значительно сокращает усилия, необходимые во время теста. Эти хорошо известные веб-приложения имеют известные заголовки HTML, файлы cookie и структуры каталогов, которые можно перечислить для идентификации приложения. Большинство веб-фреймворков имеют несколько маркеров в тех местах, которые помогают злоумышленнику или тестеру распознавать их. Это в основном то, что делают все автоматические инструменты, они ищут маркер из предопределенного местоположения, а затем сравнивают его с базой данных известных подписей. Для большей точности обычно используются несколько маркеров.

## Цели теста

- Отпечаток компонентов, используемых веб-приложениями.

## Как проверить

### Black-Box Testing

Есть несколько общих мест для определения структур или компонентов:

- HTTP-заголовки
- Печенье
- Исходный код HTML
- Конкретные файлы и папки
- Расширения файлов
- Сообщения об ошибках

#### Заголовки HTTP

Самая основная форма идентификации веб-фрейма - это просмотр поля `X-Powered-By` в заголовке ответа HTTP. Многие инструменты могут быть использованы для снятия отпечатков пальцев с цели, самый простой - netcat.

Рассмотрим следующий HTTP-запрос-ответ:

```html
$ nc 127.0.0.1 80
HEAD / HTTP/1.0

HTTP/1.1 200 OK
Server: nginx/1.0.14
[...]
X-Powered-By: Mono
```

Из поля `X-Powered-By` мы понимаем, что структура веб-приложений, вероятно, будет `Mono`. Однако, хотя этот подход прост и быстр, эта методология не работает в 100% случаев. Можно легко отключить заголовок `X-Powered-By` с помощью правильной конфигурации. Существует также несколько методов, которые позволяют веб-сайту запутывать заголовки HTTP (см. Пример в [Remediation](#Remediation) section). В приведенном выше примере мы также можем отметить, что для обслуживания контента используется конкретная версия `nginx`.

Таким образом, в том же примере тестер может пропустить заголовок `X-Powered-By` или получить ответ, как следующий:

```html
HTTP/1.1 200 OK
Server: nginx/1.0.14
Date: Sat, 07 Sep 2013 08:19:15 GMT
Content-Type: text/html;charset=ISO-8859-1
Connection: close
Vary: Accept-Encoding
X-Powered-By: Blood, sweat and tears
```

Иногда есть больше заголовков HTTP, которые указывают на определенную структуру. В следующем примере, согласно информации из HTTP-запроса, можно увидеть, что заголовок `X-Powered-By` содержит версию PHP. Однако заголовок `X-Generator` указывает, что используемая структура на самом деле `Swiftlet`, что помогает тестеру проникновения расширять свои векторы атаки. При выполнении дактилоскопии тщательно проверяйте каждый заголовок HTTP на наличие таких утечек.

```html
HTTP/1.1 200 OK
Server: nginx/1.4.1
Date: Sat, 07 Sep 2013 09:22:52 GMT
Content-Type: text/html
Connection: keep-alive
Vary: Accept-Encoding
X-Powered-By: PHP/5.4.16-1~dotdeb.1
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
X-Generator: Swiftlet
```

#### Cookies

Другим аналогичным и несколько более надежным способом определения текущей веб-структуры являются файлы cookie для конкретной структуры.

Рассмотрим следующий HTTP-запрос:

![Cakephp HTTP Request](images/Cakephp_cookie.png)\
*Figure 4.1.8-7: Cakephp HTTP Request*

Файл cookie `CAKEPHP` был установлен автоматически, что дает информацию об используемой структуре. Список распространенных имен файлов cookie представлен в [Cookies](#Cookies) раздел. Ограничения по-прежнему существуют в зависимости от этого механизма идентификации - можно изменить название файлов cookie. Например, для выбранной структуры `CakePHP` это можно сделать с помощью следующей конфигурации (выдержка из `core.php`):

```php
/**
* The name of CakePHP's session cookie.
*
* Note the guidelines for Session names states: "The session name references
* the session id in cookies and URLs. It should contain only alphanumeric
* characters."
* @link http://php.net/session_name
*/
Configure::write('Session.cookie', 'CAKEPHP');
```

Однако эти изменения с меньшей вероятностью будут внесены, чем изменения в заголовке `X-Powered-By`, поэтому этот подход к идентификации можно считать более надежным.

#### Исходный код HTML

Этот метод основан на поиске определенных шаблонов в исходном коде страницы HTML. Часто можно найти много информации, которая помогает тестеру распознавать определенный компонент. Одним из распространенных маркеров являются комментарии HTML, которые непосредственно приводят к раскрытию информации о структуре. Чаще можно найти определенные специфичные для фреймворка пути, т.е. ссылки на специфичные для фреймворка папки CSS или JS. Наконец, конкретные переменные сценария могут также указывать на определенную структуру.

На скриншоте ниже можно легко узнать используемую структуру и ее версию по упомянутым маркерам. Комментарий, конкретные пути и переменные сценария могут помочь злоумышленнику быстро определить экземпляр ZK framework.

![ZK Framework Sample](images/Zk_html_source.png)\
*Figure 4.1.8-2: ZK Framework HTML Source Sample*

Часто такая информация размещается в разделе «<head>» ответов HTTP, в тегах «<meta>» или в конце страницы. Тем не менее, все ответы должны быть проанализированы, поскольку они могут быть полезны для других целей, таких как проверка других полезных комментариев и скрытых полей. Иногда веб-разработчики не заботятся о сокрытии информации об используемых фреймворках или компонентах. По-прежнему можно наткнуться на что-то подобное внизу страницы:

![Banshee Bottom Page](images/Banshee_bottom_page.png)\
*Figure 4.1.8-3: Banshee Bottom Page*

### Конкретные файлы и папки
  
Существует другой подход, который очень помогает злоумышленнику или тестеру идентифицировать приложения или компоненты с высокой точностью. Каждый веб-компонент имеет свою собственную структуру файлов и папок на сервере. Было отмечено, что можно увидеть конкретный путь из источника HTML-страницы, но иногда они не представлены там явно и все еще находятся на сервере.

Чтобы раскрыть их, используется техника, известная как принудительный просмотр или «перетирка». Dirbusting - это грубое принуждение цели с известными папками и именами файлов и мониторинг HTTP-ответов для подсчета содержимого сервера. Эта информация может использоваться как для поиска файлов по умолчанию и их атаки, так и для снятия отпечатков пальцев с веб-приложения. Dirbusting может быть выполнен несколькими способами, в приведенном ниже примере показана успешная атака на цель с поддержкой WordPress с помощью определенного списка и функциональности нарушителя Burp Suite.

![Dirbusting with Burp](images/Wordpress_dirbusting.png)\
*Figure 4.1.8-4: Dirbusting with Burp*

Мы видим, что для некоторых папок, специфичных для WordPress (например, `/wp-includes/`,` / wp-admin / `и` / wp-content /`) HTTP-ответы составляют 403 (Forbidden), 302 ( Основано, перенаправление на `wp-login.php`) и 2000 (ОК) соответственно. Это хороший показатель того, что целью является работа на WordPress. Точно так же можно перекачивать разные папки плагинов приложений и их версии. На скриншоте ниже можно увидеть типичный файл CHANGELOG плагина Drupal, который предоставляет информацию об используемом приложении и раскрывает уязвимую версию плагина.
  
  
![Drupal Botcha Disclosure](images/Drupal_botcha_disclosure.png)\
*Figure 4.1.8-5: Drupal Botcha Disclosure*

Совет: перед началом работы с dirbusting сначала проверьте файл `robots.txt`. Иногда там можно найти специфичные для приложения папки и другую конфиденциальную информацию. Пример такого файла `robots.txt` представлен на скриншоте ниже.

![Robots Info Disclosure](images/Robots-info-disclosure.png)\
*Figure 4.1.8-6: Robots Info Disclosure*

Конкретные файлы и папки различны для каждого конкретного приложения. Если идентифицированное приложение или компонент является открытым исходным кодом, может быть полезно настроить временную установку во время тестов на проникновение, чтобы лучше понять, какая инфраструктура или функциональность представлены и какие файлы могут остаться на сервере. Однако несколько хороших списков файлов уже существуют; один хороший пример [FuzzDB wordlists of predictable files/folders](https://github.com/fuzzdb-project/fuzzdb).

#### Расширения файлов
  
URL могут включать расширения файлов, которые также могут помочь идентифицировать веб-платформу или технологию.

Например, в вики OWASP используется PHP :

```text
https://wiki.owasp.org/index.php?title=Fingerprint_Web_Application_Framework&action=edit&section=4
```

Вот некоторые распространенные веб-файлы и связанные с ними технологии:

- `.php` -- PHP
- `.aspx` -- Microsoft ASP.NET
- `.jsp` -- Java Server Pages

#### Error Messages

Как видно из следующего снимка экрана, указанный путь к файловой системе указывает на использование WordPress (`wp-content`). Также тестировщики должны знать, что WordPress основан на PHP (`functions.php`).

![WordPress Parse error](images/wp-syntaxerror.png)\
*Figure 4.1.8-7: WordPress Parse Error*

## Общие идентификаторы

### Cookies

| Framework    | Cookie name                       |
|--------------|-----------------------------------|
| Zope         | zope3                             |
| CakePHP      | cakephp                           |
| Kohana       | kohanasession                     |
| Laravel      | laravel_session                   |
| phpBB        | phpbb3_                           |
| WordPress    | wp-settings                       |
| 1C-Bitrix    | BITRIX_                           |
| AMPcms       | AMP                               |
| Django CMS   | django                            |
| DotNetNuke   | DotNetNukeAnonymous               |
| e107         | e107_tz                           |
| EPiServer    | EPiTrace, EPiServer               |
| Graffiti CMS | graffitibot                       |
| Hotaru CMS   | hotaru_mobile                     |
| ImpressCMS   | ICMSession                        |
| Indico       | MAKACSESSION                      |
| InstantCMS   | InstantCMS[logdate]               |
| Kentico CMS  | CMSPreferredCulture               |
| MODx         | SN4[12symb]                       |
| TYPO3        | fe_typo_user                      |
| Dynamicweb   | Dynamicweb                        |
| LEPTON       | lep[some_numeric_value]+sessionid |
| Wix          | Domain=.wix.com                   |
| VIVVO        | VivvoSessionId                    |

### Исходный код HTML

| Application | Keyword                                                                        |
|-------------|--------------------------------------------------------------------------------|
| WordPress   | `<meta name="generator" content="WordPress 3.9.2" />`                          |
| phpBB       | `<body id="phpbb"`                                                             |
| Mediawiki   | `<meta name="generator" content="MediaWiki 1.21.9" />`                         |
| Joomla      | `<meta name="generator" content="Joomla! - Open Source Content Management" />` |
| Drupal      | `<meta name="Generator" content="Drupal 7 (http://drupal.org)" />`             |
| DotNetNuke  | `DNN Platform - [http://www.dnnsoftware.com](http://www.dnnsoftware.com)`      |

#### Генерал Маркерс

- `%framework_name%`
- `powered by`
- `built upon`
- `running`

#### Специальные маркеры
  
| Framework         | Keyword                        |
|-------------------|--------------------------------|
| Adobe ColdFusion  | `<!-- START headerTags.cfm` |
| Microsoft ASP.NET | `__VIEWSTATE`                  |
| ZK                | `<!-- ZK`                   |
| Business Catalyst | `<!-- BC_OBNW -->`       |
| Indexhibit        | `ndxz-studio`                  |

## Восстановление

Хотя можно приложить усилия для использования различных имен файлов cookie (путем изменения конфигурации), скрытия или изменения путей файлов / каталогов (путем переписывания или изменения исходного кода), удаления известных заголовков и т. Д. такие усилия сводятся к «безопасности через безвестность». Владельцы / администраторы системы должны признать, что эти усилия только замедляют работу самых основных противников. Время / усилия могут быть лучше использованы для информирования заинтересованных сторон и поддержки решений.

## Tools

Список общих и известных инструментов представлен ниже. Есть также много других утилит, а также инструменты дактилоскопии на основе фреймворка.

### WhatWeb

Website: [https://github.com/urbanadventurer/WhatWeb](https://github.com/urbanadventurer/WhatWeb)

В настоящее время один из лучших инструментов дактилоскопии на рынке. Включено по умолчанию [Kali Linux](https://www.kali.org/) build. Language: Ruby Matches for fingerprinting are made with:

- Текстовые строки (с учетом регистра)
- Регулярные выражения
- Google Hack Database запросы (ограниченный набор ключевых слов)
- MD5 хэши
- Распознавание URL
- шаблоны тегов HTML
- Пользовательский рубиновый код для пассивных и агрессивных операций

Вывод образца представлен на скриншоте ниже:

![Whatweb Output sample](images/Whatweb-sample.png)\
*Figure 4.1.8-8: Whatweb Output sample*

### Wappalyzer

Website: [https://www.wappalyzer.com/](https://www.wappalyzer.com/)

Wapplyzer доступен в моделях с несколькими вариантами использования, наиболее популярными из которых, вероятно, являются расширения Firefox / Chrome. Они работают только над соответствием регулярным выражениям и не нуждаются ни в чем, кроме страницы, которая будет загружена в браузер. Он полностью работает на уровне браузера и дает результаты в виде значков. Хотя иногда он имеет ложные срабатывания, очень удобно иметь представление о том, какие технологии использовались для создания целевого веб-сайта сразу после просмотра страницы.

Пример вывода плагина представлен на скриншоте ниже.

![Wappalyzer Output for OWASP Website](images/Owasp-wappalyzer.png)\
*Figure 4.1.8-9: Wappalyzer Output for OWASP Website*

## References

### Whitepapers

- [Saumil Shah: "An Introduction to HTTP fingerprinting"](https://web.archive.org/web/20190526182734/https://net-square.com/httprint_paper.html)
- [Anant Shrivastava : "Web Application Finger Printing"](https://anantshri.info/articles/web_app_finger_printing.html)
