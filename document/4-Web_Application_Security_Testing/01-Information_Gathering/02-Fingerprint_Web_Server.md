# Отпечаток пальца веб-сервера

|ID          |
|------------|
|WSTG-INFO-02|

## Резюме

Отпечаток отпечатков пальцев веб-сервера - это задача определения типа и версии веб-сервера, на котором работает цель. Хотя дактилоскопия веб-сервера часто инкапсулируется в инструментах автоматического тестирования, исследователям важно понять основы того, как эти инструменты пытаются идентифицировать программное обеспечение, и почему это полезно.

Точное обнаружение типа веб-сервера, на котором работает приложение, может позволить тестировщикам безопасности определить, уязвимо ли приложение для атаки. В частности, серверы, на которых запущены более старые версии программного обеспечения без современных исправлений безопасности, могут быть подвержены известным эксплойтам, специфичным для версии.

## Цели теста

- Определите версию и тип работающего веб-сервера, чтобы обеспечить дальнейшее обнаружение любых известных уязвимостей.
- 
## Как проверить

Методы, используемые для дактилоскопии веб-сервера, включают [banner grabbing](https://en.wikipedia.org/wiki/Banner_grabbing), выявление ответов на искаженные запросы и использование автоматизированных инструментов для выполнения более надежных сканирований, использующих комбинацию тактики. Фундаментальная предпосылка, с помощью которой работают все эти методы, одинакова. Все они стремятся получить некоторый ответ от веб-сервера, который затем можно сравнить с базой данных известных ответов и поведения и, таким образом, сопоставить с известным типом сервера.

### Banner Grabbing

Захват баннера выполняется путем отправки HTTP-запроса на веб-сервер и проверки его [response header](https://developer.mozilla.org/en-US/docs/Glossary/Response_header). Это может быть достигнуто с помощью различных инструментов, включая `telnet` для HTTP-запросов или `openssl` для запросов через SSL

Например, вот ответ на запрос с сервера Apache.

```http
HTTP/1.1 200 OK
Date: Thu, 05 Sep 2019 17:42:39 GMT
Server: Apache/2.4.41 (Unix)
Last-Modified: Thu, 05 Sep 2019 17:40:42 GMT
ETag: "75-591d1d21b6167"
Accept-Ranges: bytes
Content-Length: 117
Connection: close
Content-Type: text/html
...
```

Вот еще один ответ, на этот раз от nginx.

```http
HTTP/1.1 200 OK
Server: nginx/1.17.3
Date: Thu, 05 Sep 2019 17:50:24 GMT
Content-Type: text/html
Content-Length: 117
Last-Modified: Thu, 05 Sep 2019 17:40:42 GMT
Connection: close
ETag: "5d71489a-75"
Accept-Ranges: bytes
...
```

Вот как выглядит ответ от lighttpd.

```sh
HTTP/1.0 200 OK
Content-Type: text/html
Accept-Ranges: bytes
ETag: "4192788355"
Last-Modified: Thu, 05 Sep 2019 17:40:42 GMT
Content-Length: 117
Connection: close
Date: Thu, 05 Sep 2019 17:57:57 GMT
Server: lighttpd/1.4.54
```

В этих примерах тип и версия сервера четко раскрыты. Однако приложения, заботящиеся о безопасности, могут запутывать информацию своего сервера, изменяя заголовок. Например, вот выдержка из ответа на запрос сайта с измененным заголовком :

```sh
HTTP/1.1 200 OK
Server: Website.com
Date: Thu, 05 Sep 2019 17:57:06 GMT
Content-Type: text/html; charset=utf-8
Status: 200 OK
...
```

В случаях, когда информация о сервере скрыта, тестировщики могут угадать тип сервера на основе упорядочения полей заголовка. Обратите внимание, что в приведенном выше примере Apache поля следуют этому порядку:

- Date
- Server
- Last-Modified
- ETag
- Accept-Ranges
- Content-Length
- Connection
- Content-Type

Однако как в примерах nginx, так и в скрытом сервере общие поля следуют этому порядку:

- Server
- Date
- Content-Type

Тестеры могут использовать эту информацию, чтобы догадаться, что скрытый сервер - nginx. Однако, учитывая, что ряд различных веб-серверов могут совместно использовать один и тот же порядок полей, и поля могут быть изменены или удалены, этот метод не определен.

### Отправка искаженных запросов

Веб-серверы могут быть идентифицированы путем изучения их ответов об ошибках, а в случаях, когда они не были настроены, их страницы ошибок по умолчанию. Один из способов заставить сервер представить их - отправлять намеренно неверные или искаженные запросы.

Например, вот ответ на запрос несуществующего метода `SANTA CLAUS` с сервера Apache.

```sh
GET / SANTA CLAUS/1.1


HTTP/1.1 400 Bad Request
Date: Fri, 06 Sep 2019 19:21:01 GMT
Server: Apache/2.4.41 (Unix)
Content-Length: 226
Connection: close
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>400 Bad Request</title>
</head><body>
<h1>Bad Request</h1>
<p>Your browser sent a request that this server could not understand.<br />
</p>
</body></html>
```

Вот ответ на тот же запрос от nginx.

```sh
GET / SANTA CLAUS/1.1


<html>
<head><title>404 Not Found</title></head>
<body>
<center><h1>404 Not Found</h1></center>
<hr><center>nginx/1.17.3</center>
</body>
</html>
```

Вот ответ на тот же запрос от lighttpd.

```sh
GET / SANTA CLAUS/1.1


HTTP/1.0 400 Bad Request
Content-Type: text/html
Content-Length: 345
Connection: close
Date: Sun, 08 Sep 2019 21:56:17 GMT
Server: lighttpd/1.4.54

<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
         "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
  <title>400 Bad Request</title>
 </head>
 <body>
  <h1>400 Bad Request</h1>
 </body>
</html>
```

Поскольку страницы ошибок по умолчанию предлагают множество отличительных факторов между типами веб-серверов, их проверка может быть эффективным методом дактилоскопии, даже когда поля заголовков сервера скрыты.

### Использование автоматических инструментов сканирования

Как указывалось ранее, дактилоскопия веб-сервера часто включается в качестве функции инструментов автоматического сканирования. Эти инструменты могут выполнять запросы, аналогичные тем, которые были продемонстрированы выше, а также отправлять другие более специфичные для сервера зонды. Автоматизированные инструменты могут сравнивать ответы с веб-серверов намного быстрее, чем ручное тестирование, и использовать большие базы данных известных ответов для попытки идентификации сервера. По этим причинам автоматизированные инструменты с большей вероятностью дают точные результаты.

Вот некоторые широко используемые инструменты сканирования, которые включают функцию дактилоскопии веб-сервера.

- [Netcraft](https://toolbar.netcraft.com/site_report), онлайн-инструмент, который сканирует сайты на предмет информации, включая веб-сервер.
- [Nikto](https://github.com/sullo/nikto), инструмент сканирования командной строки с открытым исходным кодом.
- [Nmap](https://nmap.org/), инструмент командной строки с открытым исходным кодом, который также имеет графический интерфейс, [Zenmap](https://nmap.org/zenmap/).

## Восстановление

Хотя открытая информация о сервере сама по себе не обязательно является уязвимостью, она может помочь злоумышленникам использовать другие уязвимости, которые могут существовать. Открытая информация о сервере также может привести к тому, что злоумышленники найдут уязвимости сервера, специфичные для версии, которые можно использовать для использования непатентованных серверов. По этой причине рекомендуется принять некоторые меры предосторожности. Эти действия включают в себя:

- Наблюдение за информацией веб-сервера в заголовках, например, с Apache [mod_headers module](https://httpd.apache.org/docs/current/mod/mod_headers.html).
- Используя закаленный [reverse proxy server](https://en.wikipedia.org/wiki/Proxy_server#Reverse_proxies) создать дополнительный уровень безопасности между веб-сервером и Интернетом.
- Обеспечение актуальности веб-серверов с использованием новейших программ и исправлений безопасности.
