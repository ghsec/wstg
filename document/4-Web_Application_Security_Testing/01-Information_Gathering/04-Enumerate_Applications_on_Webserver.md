# Перечислять приложения на веб-сервере

|ID          |
|------------|
|WSTG-INFO-04|

## Резюме

Первостепенным шагом в тестировании на уязвимости веб-приложений является выяснение того, какие конкретные приложения размещены на веб-сервере. Многие приложения имеют известные уязвимости и известные стратегии атак, которые можно использовать для получения дистанционного управления или использования данных. Кроме того, многие приложения часто неправильно настраиваются или не обновляются из-за ощущения, что они используются только «внутренне» и, следовательно, угрозы не существует.
С распространением виртуальных веб-серверов традиционные отношения типа 1: 1 между IP-адресом и веб-сервером теряют большую часть своего первоначального значения. Нередко можно найти несколько веб-сайтов или приложений, символические имена которых совпадают с одним и тем же IP-адресом. Этот сценарий не ограничивается средой хостинга, но также применяется и к обычным корпоративным средам.

Специалистам по безопасности иногда дают набор IP-адресов в качестве цели для тестирования. Можно утверждать, что этот сценарий больше похож на взаимодействие типа теста на проникновение, но в любом случае ожидается, что такое назначение будет проверять все веб-приложения, доступные через эту цель. Проблема заключается в том, что на данном IP-адресе размещена служба HTTP на порту 80, но если тестер должен получить к нему доступ, указав IP-адрес (это все, что он знает), он сообщает: «На этом адресе нет веб-сервера» или подобное сообщение. ,. Но эта система может «спрятать» ряд веб-приложений, связанных с несвязанными символическими (DNS) именами. Очевидно, что степень анализа глубоко зависит от тестирования всех приложений или только тестирует приложения, о которых они знают.

Иногда целевая спецификация богаче. Тестер может получить список IP-адресов и их соответствующие символические имена. Тем не менее, этот список может передавать частичную информацию, т.е.он может опустить некоторые символические имена, и клиент может даже не знать об этом (это чаще случается в крупных организациях).

Другие вопросы, влияющие на объем оценки, представлены веб-приложениями, опубликованными по неочевидным URL-адресам (e.g., `http://www.example.com/some-strange-URL`), на которые нет ссылок в других местах. Это может произойти либо по ошибке (из-за неправильной конфигурации), либо намеренно (например, нерекламированные административные интерфейсы).

Для решения этих проблем необходимо выполнить обнаружение веб-приложений.

## Цели теста

- Перечислите приложения в объеме, которые существуют на веб-сервере.

## Как проверить

Обнаружение веб-приложений - это процесс, направленный на выявление веб-приложений в данной инфраструктуре. Последний обычно указывается как набор IP-адресов (возможно, сетевой блок), но может состоять из набора символических имен DNS или их комбинации. Эта информация выдается до проведения оценки, будь то тест на проникновение в классическом стиле или оценка, ориентированная на приложения. В обоих случаях, если правила помолвки не указывают иное (например,.тестируйте только приложение, расположенное по URL-адресу `http://www.example.com/`), оценка должна быть наиболее полной по объему, т.е. он должен идентифицировать все приложения, доступные через данную цель. В следующих примерах рассматриваются несколько методов, которые можно использовать для достижения этой цели.

> Некоторые из следующих методов применяются к веб-серверам, ориентированным на Интернет, а именно к веб-службам поиска DNS и revers-IP и использованию поисковых систем. В примерах используются частные IP-адреса (такие как `192.168.1.100`), которые, если не указано иное, представляют * общие * IP-адреса и используются только в целях анонимности.


Существует три фактора, влияющих на количество приложений, связанных с данным DNS-именем (или IP-адресом):

1. **Разный базовый URL**

    Очевидная точка входа для веб-приложения - `www.example.com`, т.е.с этой краткой нотацией мы думаем о веб-приложении, созданном по адресу `http://www.example.com/` (то же самое относится и к https). Однако, хотя это наиболее распространенная ситуация, ничто не заставляет приложение начинать с `/`.

    Например, одно и то же символическое имя может быть связано с тремя веб-приложениями, такими как: `http://www.example.com/url1` `http://www.example.com/url2` `http://www.example.com/url3`

    IВ этом случае URL-адрес `http://www.example.com/` не будет связан с значимой страницей, и три приложения будут **hidden**, если тестер явно не знает, как их достичь, т.е.Тестер знает *url1*, *url2* or *url3*. Обычно нет необходимости публиковать веб-приложения таким образом, если только владелец не хочет, чтобы они были доступны стандартным образом, и готов сообщить пользователям об их точном местонахождении. Это не означает, что эти приложения являются секретными, просто их существование и местоположение явно не рекламируются.

2. **Нестандартные порты**

    Хотя веб-приложения обычно работают на портах 80 (http) и 443 (https), в этих номерах портов нет ничего волшебного. Фактически, веб-приложения могут быть связаны с произвольными портами TCP, и на них можно ссылаться, указав номер порта следующим образом: `http[s]://www.example.com:port/`. Например, `http://www.example.com:20000/`.

3. **Виртуальные хосты**

    DNS позволяет связать один IP-адрес с одним или несколькими символическими именами. Например, IP-адрес `192.168.1.100` может быть связан с именами DNS `www.example.com`, `helpdesk.example.com`, `webmail.example.com`. Нет необходимости, чтобы все имена принадлежали одному и тому же домену DNS. Это отношение 1 к N может быть отражено для обслуживания различного контента с помощью так называемых виртуальных хостов. Информация, указывающая виртуальный хост, на который мы ссылаемся, встроена в HTTP 1.1 [Host header](https://tools.ietf.org/html/rfc2616#section-14.23).

    Никто не заподозрит существование других веб-приложений в дополнение к очевидному `www.example.com`, если они не знают `helpdesk.example.com` и `webmail.example.com`.

### Подходы к решению проблемы 1 - нестандартные URL

Нет никакого способа полностью установить существование нестандартных веб-приложений. Будучи нестандартным, не существует фиксированных критериев, регулирующих соглашение об именах, однако существует ряд методов, которые тестер может использовать для получения дополнительной информации.

Во-первых, если веб-сервер неправильно настроен и позволяет просматривать каталоги, возможно, можно обнаружить эти приложения. Сканеры уязвимости могут помочь в этом отношении.

Во-вторых, на эти приложения могут ссылаться другие веб-страницы, и есть вероятность, что они были проанализированы и проиндексированы поисковыми системами. Если тестеры подозревают существование такого **hidden** приложения на `www.example.com` могли искать с помощью оператора * site * и проверять результат запроса на `site: www.example.com`. Среди возвращаемых URL-адресов может быть один, указывающий на такое неочевидное приложение.

Другой вариант - исследовать URL-адреса, которые могут быть вероятными кандидатами для неопубликованных приложений. Например, интерфейс веб-почты может быть доступен по URL-адресам, таким как `https://www.example.com/webmail`, `https://webmail.example.com/` или` https://mail.example.com/`. То же самое относится и к административным интерфейсам, которые могут публиковаться по скрытым URL-адресам (например, административному интерфейсу Tomcat), но нигде не упоминаются. Таким образом, выполнение небольшого поиска в словарном стиле (или «интеллектуальное угадывание») может дать некоторые результаты. Сканеры уязвимости могут помочь в этом отношении.

### Подходы к решению проблемы 2 - нестандартные порты

Легко проверить наличие веб-приложений на нестандартных портах. Сканер портов, такой как nmap, способен выполнять распознавание услуг с помощью опции `-sV` и идентифицирует службы http [s] на произвольных портах. Требуется полное сканирование всего адресного пространства 64k TCP-порта.

Например, следующая команда будет искать при сканировании TCP-соединения все открытые порты в IP `192.168.1.100` и будет пытаться определить, какие службы связаны с ними (отображаются только * существенные * переключатели - nmap имеет широкий набор параметров, обсуждение которых выходит за рамки):

`nmap –Pn –sT –sV –p0-65535 192.168.1.100`

Достаточно проверить вывод и найти http или индикацию служб в оболочке SSL (которые должны быть проверены, чтобы подтвердить, что они являются https). Например, выходные данные предыдущей команды могут выглядеть как:

```bash
Interesting ports on 192.168.1.100:
(The 65527 ports scanned but not shown below are in state: closed)
PORT      STATE SERVICE     VERSION
22/tcp    open  ssh         OpenSSH 3.5p1 (protocol 1.99)
80/tcp    open  http        Apache httpd 2.0.40 ((Red Hat Linux))
443/tcp   open  ssl         OpenSSL
901/tcp   open  http        Samba SWAT administration server
1241/tcp  open  ssl         Nessus security scanner
3690/tcp  open  unknown
8000/tcp  open  http-alt?
8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
```

FВ этом примере можно увидеть, что :

- На порту 80 работает HTTP-сервер Apache.
- Похоже, что на порту 443 есть HTTPS-сервер (но это необходимо подтвердить, например, посетив `https://192.168.1.100` с браузером).
- На порту 901 есть веб-интерфейс Samba SWAT.
- Служба на порту 1241 не HTTPS, а демон Nessus в оболочке SSL.
- Порт 3690 имеет неопределенную услугу (nmap возвращает свой * отпечаток пальца * - здесь опущен для ясности - вместе с инструкциями представить его для включения в базу данных отпечатков пальцев nmap, при условии, что вы знаете, какую услугу он представляет).
- еще одна неуказанная услуга на порту 8000; это может быть HTTP, поскольку на этом порту нередко можно найти HTTP-серверы. Давайте рассмотрим этот вопрос

```bash
$ telnet 192.168.10.100 8000
Trying 192.168.1.100...
Connected to 192.168.1.100.
Escape character is '^]'.
GET / HTTP/1.0

HTTP/1.0 200 OK
pragma: no-cache
Content-Type: text/html
Server: MX4J-HTTPD/1.0
expires: now
Cache-Control: no-cache

<html>
...
```

Это подтверждает, что на самом деле это HTTP-сервер. Альтернативно, тестеры могли посетить URL с веб-браузером; или использовали команды GET или HEAD Perl, которые имитируют HTTP-взаимодействия, такие как приведенный выше (однако запросы HEAD могут выполняться не всеми серверами).

- Apache Tomcat работает на порту 8080.

Та же задача может быть выполнена сканерами уязвимости, но сначала убедитесь, что выбранный сканер способен идентифицировать службы HTTP [S], работающие на нестандартных портах. Например, Nessus способен идентифицировать их на произвольных портах (при условии, что ему поручено сканировать все порты), и предоставит, в отношении nmap, ряд тестов на известных уязвимостях веб-сервера, а также на конфигурации SSL. услуг HTTPS. Как указывалось ранее, Nessus также может находить популярные приложения или веб-интерфейсы, которые в противном случае могли бы остаться незамеченными (например, административный интерфейс Tomcat).

### Подходы к решению проблемы 3 - Виртуальные хосты

Существует ряд методов, которые можно использовать для идентификации имен DNS, связанных с данным IP-адресом `x.y.z.t`.

#### DNS Zone Transfers

Этот метод в настоящее время ограничен, учитывая тот факт, что передача зон в основном не выполняется DNS-серверами. Тем не менее, это может стоить попробовать. Прежде всего, тестировщики должны определить серверы имен, обслуживающие `x.y.z.t`. Если символическое имя известно как `x.y.z.t` (пусть это будет `www.example.com`), его серверы имен могут быть определены с помощью таких инструментов, как `nslookup`, `host` или `dig `, запрашивая записи DNS NS.

Если для `x.y.z.t` не известны символические имена, но определение цели содержит по крайней мере символическое имя, тестеры могут попытаться применить тот же процесс и запросить сервер имен этого имени (надеясь, что `x.y.z.t` также будет обслуживаться этим сервером имен). Например, если цель состоит из IP-адреса `x.y.z.t` и имени `mail.example.com`, определите серверы имен для домена `example.com`.

В следующем примере показано, как идентифицировать серверы имен для `www.owasp.org` с помощью команды `host`:

```bash
$ host -t ns www.owasp.org
www.owasp.org is an alias for owasp.org.
owasp.org name server ns1.secure.net.
owasp.org name server ns2.secure.net.
```

Теперь передача зоны может быть запрошена на серверы имен для домена `example.com`. Если тестеру повезет, он вернет список записей DNS для этого домена. Это будет включать очевидные `www.example.com` и не столь очевидные `helpdesk.example.com` и `webmail.example.com` (и, возможно, другие). Проверьте все имена, возвращаемые передачей зоны, и рассмотрите все те, которые связаны с оцениваемой целью.

Попытка запросить передачу зоны для `owasp.org` с одного из серверов имен :

```bash
$ host -l www.owasp.org ns1.secure.net
Using domain server:
Name: ns1.secure.net
Address: 192.220.124.10#53
Aliases:

Host www.owasp.org not found: 5(REFUSED)
; Transfer failed.
```

#### Обратные запросы DNS

Этот процесс аналогичен предыдущему, но опирается на обратные (PTR) записи DNS. Вместо того, чтобы запрашивать передачу зоны, попробуйте установить тип записи в PTR и выдать запрос по заданному IP-адресу. Если тестерам повезет, они могут вернуть запись DNS-имени. Этот метод основан на существовании карт имен IP-символических, что не гарантируется.

#### Поиски DNS на основе Интернета

Этот вид поиска сродни передаче зоны DNS, но опирается на веб-службы, которые позволяют искать по DNS на основе имен. Одним из таких сервисов является [Netcraft Search DNS](https://searchdns.netcraft.com/?host) служба.  Тестер может запросить список имен, принадлежащих вашему домену по вашему выбору, таких как `example.com`. Затем они проверят, соответствуют ли полученные ими имена цели, которую они изучают.

#### Reverse-IP Services

Службы обратного IP аналогичны обратным запросам DNS, с той разницей, что тестеры запрашивают веб-приложение вместо сервера имен. Есть ряд таких услуг, доступных. Поскольку они имеют тенденцию возвращать частичные (и часто разные) результаты, лучше использовать несколько сервисов для получения более полного анализа.

- [Domain Tools Reverse IP](https://www.domaintools.com/reverse-ip/) (требует свободного членства)
- [DNSstuff](https://www.dnsstuff.com/) (доступно несколько услуг)
- [Net Square](https://web.archive.org/web/20190515092354/http://www.net-square.com/mspawn.html) (запросы на домены и IP-адреса, требует установки)

#### Googling

После сбора информации из предыдущих методов, тестеры могут полагаться на поисковые системы, чтобы, возможно, уточнить и увеличить свой анализ. Это может привести к появлению дополнительных символических имен, принадлежащих цели, или приложений, доступных по неочевидным URL-адресам.

Например, учитывая предыдущий пример, касающийся `www.owasp.org`, тестер может запросить у Google и других поисковых систем информацию (отсюда и имена DNS), связанную с недавно обнаруженными доменами `webgoat.org`, `webscarab. com `и` webscarab.net `.

Методы поиска в Google объясняются в [Testing: Spiders, Robots, and Crawlers](01-Conduct_Search_Engine_Discovery_Reconnaissance_for_Information_Leakage.md).

#### Digital Certificates

Если сервер принимает соединения через HTTPS, то общее имя (CN) и имя субъекта (SAN) в сертификате могут содержать одно или несколько имен хостов. Однако, если веб-сервер не имеет доверенного сертификата или используются подстановочные знаки, это может не вернуть действительную информацию.

CN и SAN можно получить, вручную проверив сертификат или с помощью других инструментов, таких как OpenSSL :

```sh
openssl s_client -connect 93.184.216.34:443 </dev/null 2>/dev/null | openssl x509 -noout -text | grep -E 'DNS:|Subject:'

Subject: C = US, ST = California, L = Los Angeles, O = Internet Corporation for Assigned Names and Numbers, CN = www.example.org
DNS:www.example.org, DNS:example.com, DNS:example.edu, DNS:example.net, DNS:example.org, DNS:www.example.com, DNS:www.example.edu, DNS:www.example.net
```

## Tools

- DNS lookup tools such as `nslookup`, `dig` and similar.
- Search engines (Google, Bing and other major search engines).
- Specialized DNS-related web-based search service: see text.
- [Nmap](https://nmap.org/)
- [Nessus Vulnerability Scanner](https://www.tenable.com/products/nessus)
- [Nikto](https://www.cirt.net/nikto2)
