# Тестирование на функциональность выхода из системы

| ID |
| ------------- |
| WSTG-SESS-06 |

## Резюме

Завершение сеанса является важной частью жизненного цикла сеанса. Сокращение до минимума срока службы токенов сеанса снижает вероятность успешной атаки при перехвате сеанса. Это можно рассматривать как контроль против предотвращения других атак, таких как кросс-сайтовый скриптинг и кросс-сайтовый запрос. Известно, что такие атаки зависят от пользователя, имеющего аутентифицированный сеанс. Отсутствие безопасного завершения сеанса только увеличивает поверхность атаки для любой из этих атак.

Безопасное завершение сеанса требует как минимум следующих компонентов:

- Наличие элементов управления пользовательского интерфейса, которые позволяют пользователю вручную выходить из системы.
- Завершение сеанса по истечении определенного времени без активности (тайм-аут сеанса).
- Правильная недействительность состояния сеанса на стороне сервера.

Существует несколько проблем, которые могут помешать эффективному прекращению сеанса. Для идеального безопасного веб-приложения пользователь должен иметь возможность прекратить работу в любое время через пользовательский интерфейс. Каждая страница должна содержать кнопку выхода из системы в месте, где она непосредственно видна. Неясные или неоднозначные функции выхода из системы могут привести к тому, что пользователь не будет доверять такой функциональности.

Другая распространенная ошибка в завершении сеанса заключается в том, что для токена сеанса на стороне клиента установлено новое значение, в то время как состояние на стороне сервера остается активным и его можно повторно использовать, установив cookie сеанса обратно в предыдущее значение. Иногда пользователю отображается только подтверждающее сообщение без каких-либо дальнейших действий. Этого следует избегать.

Некоторые структуры веб-приложений полагаются исключительно на cookie-файл сеанса для идентификации зарегистрированного пользователя. Идентификатор пользователя встроен в (зашифрованное) значение cookie. Сервер приложений не выполняет никаких отслеживания на стороне сервера сеанса. При выходе из системы cookie сеанса удаляется из браузера. Однако, поскольку приложение не выполняет никаких проверок, оно не знает, вышел ли сеанс из системы или нет. Таким образом, повторно используя cookie сеанса, можно получить доступ к аутентифицированному сеансу. Хорошо известным примером этого является функция аутентификации форм в ASP.NET

Пользователи веб-браузеров часто не возражают против того, что приложение все еще открыто, и просто закрывают браузер или вкладку. Веб-приложение должно знать об этом поведении и автоматически завершать сеанс на стороне сервера через определенное время.

Использование системы единого входа (SSO) вместо схемы аутентификации для конкретного приложения часто приводит к сосуществованию нескольких сеансов, которые должны завершаться отдельно. Например, завершение сеанса для конкретной приложения не завершает сеанс в системе SSO. Возвращение на портал SSO дает пользователю возможность войти обратно в приложение, где выход был выполнен непосредственно перед этим. С другой стороны, функция выхода из системы в системе SSO не обязательно вызывает завершение сеанса в подключенных приложениях.

## Цели теста

- Оцените пользовательский интерфейс выхода из системы .
- Проанализируйте тайм-аут сеанса и, если сеанс правильно убит после выхода из системы.

## Как проверить

### Тестирование на выход из пользовательского интерфейса

Проверьте внешний вид и видимость функциональности выхода из системы в пользовательском интерфейсе. Для этого просмотрите каждую страницу с точки зрения пользователя, который намерен выйти из веб-приложения.

> Есть некоторые свойства, которые указывают на хороший пользовательский интерфейс выхода из системы:
>
> - На всех страницах веб-приложения присутствует кнопка выхода из системы.
> - Кнопка выхода из системы должна быть быстро идентифицирована пользователем, который хочет выйти из веб-приложения.
> - После загрузки страницы кнопка выхода из системы должна быть видна без прокрутки.
> - В идеале кнопка выхода из системы помещается в область страницы, которая фиксируется в порту просмотра браузера и не зависит от прокрутки содержимого.

### Тестирование для завершения сеанса на стороне сервера

Сначала сохраните значения файлов cookie, которые используются для идентификации сеанса. Вызовите функцию выхода из системы и наблюдайте за поведением приложения, особенно в отношении файлов cookie сеанса. Попробуйте перейти на страницу, которая видна только в аутентифицированном сеансе, например,. с помощью кнопки «Назад» браузера. Если отображается кэшированная версия страницы, используйте кнопку перезагрузки, чтобы обновить страницу с сервера. Если функция выхода из системы приводит к тому, что cookie-файлы сеанса устанавливаются в новое значение, восстановите старое значение cookie-файлов сеанса и перезагрузите страницу из аутентифицированной области приложения. Если в этом тесте не отображаются какие-либо уязвимости на конкретной странице, попробуйте хотя бы несколько дополнительных страниц приложения, которые считаются критически важными для безопасности, чтобы гарантировать, что завершение сеанса должным образом распознается этими областями приложения.

> Никакие данные, которые должны быть видны только аутентифицированным пользователям, не должны быть видны на исследованных страницах при выполнении тестов. В идеале приложение перенаправляет в общедоступную область или форму входа при доступе к аутентифицированным областям после завершения сеанса. Это не должно быть необходимым для безопасности приложения, но установка файлов cookie сеанса на новые значения после выхода из системы обычно считается хорошей практикой.

### Тестирование на тайм-аут сеанса

Попробуйте определить тайм-аут сеанса, выполнив запросы на страницу в аутентифицированной области веб-приложения с растущими задержками. Если появляется поведение выхода из системы, используемая задержка приблизительно соответствует значению тайм-аута сеанса.

> Те же результаты, что и для тестирования завершения сеанса на стороне сервера, описанного ранее, исключаются выходом из системы, вызванным отсутствием тайм-аута.
>
> Надлежащее значение для тайм-аута сеанса зависит от цели приложения и должно быть балансом безопасности и удобства использования. В банковских приложениях нет смысла хранить неактивный сеанс более 15 минут. С другой стороны, короткий тайм-аут в вики или форуме может раздражать пользователей, которые печатают длинные статьи с ненужными запросами входа в систему. Там тайм-ауты часа и более могут быть приемлемыми.

### Тестирование на завершение сеанса в среде с одним входом (единый выход)

Выполните вход в тестируемое приложение. Проверьте, есть ли центральный портал или каталог приложений, который позволяет пользователю войти в приложение без аутентификации. Проверьте, запрашивает ли приложение аутентификацию, если запрашивается URL-адрес точки входа в приложение. Во время входа в тестируемое приложение выполните выход из системы SSO. Затем попробуйте получить доступ к аутентифицированной области тестируемого приложения.

> Ожидается, что вызов функции выхода из системы в веб-приложении, подключенном к системе SSO, или в самой системе SSO вызывает глобальное завершение всех сеансов. Для получения доступа к приложению после выхода из системы SSO и подключенного приложения должна быть необходима аутентификация пользователя.

## Tools

- [Burp Suite - Repeater](https://portswigger.net/burp/documentation/desktop/tools/repeater)

## References

### Whitepapers

- [Cookie replay attacks in ASP.NET when using forms authentication](https://www.vanstechelman.eu/content/cookie-replay-attacks-in-aspnet-when-using-forms-authentication)
