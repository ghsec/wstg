# Тестирование для учета учетной записи и предполагаемой учетной записи пользователя

| ID |
| ------------- |
| WSTG-IDNT-04 |

## Резюме

Область применения этого теста состоит в том, чтобы проверить, можно ли собрать набор действительных имен пользователей путем взаимодействия с механизмом аутентификации приложения. Этот тест будет полезен для проверки грубой силы, при которой тестер проверяет, можно ли найти соответствующий пароль при наличии действительного имени пользователя.

Часто веб-приложения показывают, когда в системе существует имя пользователя, либо из-за неправильной конфигурации, либо из-за решения о дизайне. Например, иногда, когда мы отправляем неправильные учетные данные, мы получаем сообщение, в котором говорится, что либо имя пользователя присутствует в системе, либо предоставленный пароль является неправильным. Полученная информация может быть использована злоумышленником для получения списка пользователей в системе. Эта информация может использоваться для атаки веб-приложения, например, с помощью грубой силы или атаки имени пользователя и пароля по умолчанию.

Тестер должен взаимодействовать с механизмом аутентификации приложения, чтобы понять, вызывает ли отправка определенных запросов ответ приложения по-разному. Эта проблема существует, потому что информация, полученная из веб-приложения или веб-сервера, когда пользователь предоставляет действительное имя пользователя, отличается от информации, когда он использует недопустимое.

В некоторых случаях принимается сообщение, которое показывает, что предоставленные учетные данные неверны, поскольку использовалось неверное имя пользователя или неверный пароль. Иногда тестеры могут перечислять существующих пользователей, отправляя имя пользователя и пустой пароль.

## Цели теста

- Просмотр процессов, относящихся к идентификации пользователя (* например.* регистрация, вход в систему и т. д.).
- Перечислять пользователей, где это возможно, с помощью анализа ответов.

## Как проверить

При тестировании в черном ящике тестер ничего не знает о конкретном приложении, имени пользователя, логике приложения, сообщениях об ошибках на странице входа в систему или средствах восстановления пароля. Если приложение уязвимо, тестер получает ответное сообщение, которое прямо или косвенно раскрывает некоторую информацию, полезную для перечисления пользователей.

### HTTP Response Message

#### Тестирование на действительные полномочия

Запишите ответ сервера при отправке действительного идентификатора пользователя и действительного пароля.

> Используя веб-прокси, обратите внимание на информацию, полученную из этой успешной аутентификации (ответ HTTP 200, длина ответа).

#### Тестирование на действительного пользователя с неправильным паролем

Теперь тестер должен попытаться вставить действительный идентификатор пользователя и неправильный пароль и записать сообщение об ошибке, сгенерированное приложением.

> Браузер должен отображать сообщение, аналогичное следующему:
>
> ![Authentication Failed](images/AuthenticationFailed.png)\
> *Figure 4.3.4-1: Authentication Failed*
>
> В отличие от любого сообщения, которое раскрывает существование пользователя, как следующее:
>
> `Вход в систему для пользователя foo: неверный пароль`
>
> Используя веб-прокси, обратите внимание на информацию, полученную в результате этой неудачной попытки аутентификации (ответ HTTP 200, длина ответа).

#### Тестирование на несуществующее имя пользователя

Теперь тестер должен попытаться вставить неверный идентификатор пользователя и неправильный пароль и записать ответ сервера (тестер должен быть уверен, что имя пользователя недействительно в приложении). Запишите сообщение об ошибке и ответ сервера.

> Если тестер вводит несуществующий идентификатор пользователя, он может получить сообщение, похожее на:
>
> ![This User is Not Active](images/Userisnotactive.png)\
> *Figure 4.3.4-3: This User is Not Active*
>
> или сообщение, как следующее:
>
> `Вход не удался для пользователя foo: недействительная учетная запись`
>
> Обычно приложение должно отвечать одним и тем же сообщением об ошибке и длиной на разные неправильные запросы. Если ответы не совпадают, тестер должен исследовать и выяснить ключ, который создает разницу между двумя ответами. Например:
>
> 1. Запрос клиента: действительный пароль пользователя / неправильного
> 2. Ответ сервера: пароль не правильный
> 3. Запрос клиента: неправильный пользователь / неправильный пароль
> 4. Ответ сервера: пользователь не распознается
>
> Приведенные выше ответы позволяют клиенту понять, что для первого запроса у него есть действительное имя пользователя. Таким образом, они могут взаимодействовать с приложением, запрашивающим набор возможных идентификаторов пользователя и наблюдающим за ответом.
>
> Глядя на ответ второго сервера, тестер понимает так же, как и имя пользователя. Таким образом, они могут взаимодействовать одинаково и создавать список действительных идентификаторов пользователей, просматривая ответы сервера.

### Другие способы привлечения пользователей

Тестеры могут перечислять пользователей несколькими способами, такими как:

#### Анализ кода ошибки, полученного на страницах входа

Некоторые веб-приложения выпускают определенный код ошибки или сообщение, которое мы можем проанализировать.

#### Анализ URL-адресов и URL-адресов

Например:

- `http://www.foo.com/err.jsp?User=baduser&Error=0`
- `http://www.foo.com/err.jsp?User=gooduser&Error=2`

Как видно выше, когда тестер предоставляет идентификатор пользователя и пароль веб-приложению, он видит сообщение о том, что в URL произошла ошибка. В первом случае они предоставили неверный идентификатор пользователя и неверный пароль. Во втором - хороший идентификатор пользователя и плохой пароль, чтобы они могли идентифицировать действительный идентификатор пользователя

#### URI Probing

Иногда веб-сервер реагирует по-разному, если он получает запрос на существующий каталог или нет. Например, на некоторых порталах каждый пользователь связан с каталогом. Если тестеры попытаются получить доступ к существующему каталогу, они могут получить ошибку веб-сервера.

Некоторые из распространенных ошибок, полученных от веб-серверов:

- 403 Запретный код ошибки
- 404 Не найден код ошибки

Пример:

- `http://www.foo.com/account1` - we receive from web server: 403 Forbidden
- `http://www.foo.com/account2` - we receive from web server: 404 file Not Found

В первом случае пользователь существует, но тестер не может просматривать веб-страницу, во втором случае вместо этого пользователь «account2» не существует. Собирая эту информацию, тестеры могут перечислять пользователей.

#### Анализ заголовков веб-страниц

Тестеры могут получать полезную информацию в заголовке веб-страницы, где они могут получить определенный код ошибки или сообщения, которые показывают, связаны ли проблемы с именем пользователя или паролем.

Например, если пользователь не может пройти аутентификацию в приложении и получает веб-страницу, заголовок которой похож на:

- `Invalid user`
- `Invalid authentication`

#### Анализ сообщения, полученного из средства восстановления

Когда мы используем средство восстановления (т.е. функция забытого пароля) уязвимое приложение может вернуть сообщение, которое показывает, существует ли имя пользователя или нет.

Например, сообщения похожи на следующие:

- `Invalid username: email address is not valid or the specified user was not found.`
- `Valid username: Your password has been successfully sent to the email address you registered with.`

#### Дружественное сообщение об ошибке 404

Когда мы запрашиваем пользователя в каталоге, который не существует, мы не всегда получаем код ошибки 404. Вместо этого мы можем получить «200 ок» с изображением, в этом случае мы можем предположить, что при получении определенного изображения пользователя не существует. Эта логика может быть применена к ответу другого веб-сервера; хитрость заключается в хорошем анализе сообщений веб-сервера и веб-приложений.

#### Анализ времени отклика

Помимо рассмотрения содержания ответов, следует также учитывать время, которое требуется для ответа. В частности, если запрос вызывает взаимодействие с внешней службой (например, отправка электронной почты с забытым паролем), это может добавить несколько сотен миллисекунд к ответу, который можно использовать для определения того, является ли запрашиваемый пользователь действительным.

### Угадай пользователей

В некоторых случаях идентификаторы пользователей создаются с помощью определенных политик администратора или компании. Например, мы можем просмотреть пользователя с идентификатором пользователя, созданным в последовательном порядке:

```text
CN000100
CN000101
...
```

Иногда имена пользователей создаются с псевдонимом REALM, а затем с последовательными номерами:

- R1001 – user 001 for REALM1
- R2001 – user 001 for REALM2

В приведенном выше примере мы можем создать простые сценарии оболочки, которые составляют идентификаторы пользователей и отправляют запрос с помощью такого инструмента, как wget, для автоматизации веб-запроса для распознавания действительных идентификаторов пользователей. Чтобы создать скрипт, мы также можем использовать Perl и curl.

Другие возможности: - идентификаторы пользователей, связанные с номерами кредитных карт, или общие номера с шаблоном. - идентификаторы пользователей, связанные с реальными именами, например,. если у Фредди Меркьюри есть идентификатор пользователя «fmercury», то вы можете догадаться, что у Роджера Тейлора есть идентификатор пользователя «rtaylor».

Опять же, мы можем угадать имя пользователя из информации, полученной из запроса LDAP или из сбора информации Google, например, из определенного домена. Google может помочь найти пользователей домена с помощью определенных запросов или с помощью простого сценария оболочки или инструмента.

> Перечисляя учетные записи пользователей, вы рискуете заблокировать учетные записи после заранее определенного количества неисправных датчиков (на основе политики приложения). Кроме того, иногда ваш IP-адрес может быть запрещен динамическими правилами на брандмауэре приложения или в системе предотвращения вторжений.

### Тестирование серой коробки

#### Тестирование сообщений об ошибках аутентификации

Убедитесь, что приложение отвечает одинаково для каждого клиентского запроса, который выдает неудачную аутентификацию. Для этого выпуска тестирование в черном ящике и тестирование в сером ящике имеют одну и ту же концепцию, основанную на анализе сообщений или кодов ошибок, полученных от веб-приложения.

> Приложение должно отвечать одинаково за каждую неудачную попытку аутентификации.
>
> Например: *Credentials submitted are not valid*

## Восстановление

Убедитесь, что приложение возвращает согласованные общие сообщения об ошибках в ответ на неверное имя учетной записи, пароль или другие учетные данные пользователя, введенные во время процесса входа в систему.

Убедитесь, что системные учетные записи и тестовые учетные записи по умолчанию удалены до выпуска системы в производство (или ее доведения до ненадежной сети).

## Инструменты

- [OWASP Zed Attack Proxy (ZAP)](https://www.zaproxy.org)
- [curl](https://curl.haxx.se/)
- [PERL](https://www.perl.org)

## References

- [Marco Mella, Sun Java Access & Identity Manager Users enumeration](https://securiteam.com/exploits/5ep0f0uquo/)
- [Username Enumeration Vulnerabilities](https://www.gnucitizen.org/blog/username-enumeration-vulnerabilities/)
